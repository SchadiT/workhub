<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turbo-Projects Work Hub</title>
    <!-- MSAL Auth Library - Multiple fallbacks -->
    <script>
        window.msalLoaded = false;
        function msalLoadSuccess() { window.msalLoaded = true; console.log('‚úÖ MSAL loaded'); }
        function tryNextCDN(cdnList, index) {
            if (index >= cdnList.length) {
                console.error('‚ùå All CDNs failed');
                document.getElementById('auth-status-text').textContent = '‚ùå Auth Library fehlt';
                return;
            }
            var s = document.createElement('script');
            s.src = cdnList[index];
            s.onload = msalLoadSuccess;
            s.onerror = function() { 
                console.log('CDN ' + (index+1) + ' failed: ' + cdnList[index]);
                tryNextCDN(cdnList, index + 1);
            };
            document.head.appendChild(s);
        }
    </script>
    <script src="https://unpkg.com/@azure/msal-browser@2.38.3/lib/msal-browser.min.js" onload="msalLoadSuccess()" onerror="tryNextCDN([
        'https://cdn.jsdelivr.net/npm/@azure/msal-browser@2.38.3/lib/msal-browser.min.js',
        'https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js',
        'https://cdnjs.cloudflare.com/ajax/libs/msal-browser/2.38.3/msal-browser.min.js'
    ], 0)"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 28px; margin-bottom: 5px; }
        .header p { color: #888; font-size: 14px; }
        
        /* Auth Status Bar */
        .auth-bar {
            display: flex; justify-content: center; align-items: center; gap: 10px;
            margin-bottom: 15px; padding: 10px; background: #252542; border-radius: 10px;
            flex-wrap: wrap;
        }
        .auth-status { display: flex; align-items: center; gap: 8px; font-size: 13px; }
        .auth-status .dot { width: 8px; height: 8px; border-radius: 50%; background: #ef4444; }
        .auth-status .dot.connected { background: #22c55e; }
        .auth-btn {
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);
            border: none; border-radius: 8px; padding: 8px 16px;
            color: white; font-size: 13px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; gap: 6px;
        }
        .auth-btn:hover { opacity: 0.9; }
        .auth-btn.logout { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }
        .auth-user { font-size: 12px; color: #888; }
        
        /* Quick Actions */
        .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
        .quick-actions-row2 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
        .quick-actions-row3 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        
        .quick-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; border-radius: 12px; padding: 15px 10px;
            color: white; text-decoration: none; text-align: center;
            font-weight: 600; font-size: 13px; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s; display: block;
        }
        .quick-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        
        .dropdown-container { position: relative; }
        .dropdown-btn { background: linear-gradient(135deg, #E4405F 0%, #c13584 100%); width: 100%; }
        .dropdown-btn.sales { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .dropdown-content {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #252542; border-radius: 8px; margin-top: 5px; z-index: 100;
            overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .dropdown-content.show { display: block; }
        .dropdown-item {
            display: block; padding: 12px 15px; color: white; text-decoration: none;
            font-size: 13px; border-bottom: 1px solid #3d3d54; transition: background 0.2s;
        }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background: #3d3d54; }
        .dropdown-item .icon { margin-right: 8px; }
        
        .btn-graphics { background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%); }
        .btn-whatsapp { background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); }
        .btn-email { background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%); }
        .btn-presale { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .btn-calculator { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .btn-projector { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .btn-factsheet { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        /* Modal Styles */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: flex-start;
            overflow-y: auto; padding: 20px;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: #252542; border-radius: 15px; width: 100%; max-width: 800px;
            margin: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            border-radius: 15px 15px 0 0;
        }
        .modal-header.orange { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .modal-header.purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .modal-header.green { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .modal-header.blue { background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%); }
        .modal-header h3 { font-size: 18px; font-weight: 700; }
        .modal-close { background: none; border: none; color: white; font-size: 28px; cursor: pointer; line-height: 1; }
        .modal-body { padding: 20px; max-height: 70vh; overflow-y: auto; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #3d3d54; display: flex; justify-content: flex-end; gap: 10px; }
        
        /* Form Styles */
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 13px; color: #888; margin-bottom: 5px; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 10px 12px; border-radius: 8px;
            border: 1px solid #3d3d54; background: #1a1a2e; color: #fff;
            font-size: 14px; font-family: inherit;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: #667eea;
        }
        .form-group input[type="number"] { text-align: right; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-group-inline { display: flex; align-items: center; gap: 10px; }
        .form-hint { font-size: 11px; color: #666; margin-top: 4px; }
        
        .modal-btn {
            padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600;
            cursor: pointer; border: none; transition: all 0.2s;
        }
        .modal-btn.cancel { background: #3d3d54; color: #fff; }
        .modal-btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .modal-btn.success { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: #fff; }
        .modal-btn:hover { opacity: 0.9; transform: translateY(-1px); }
        
        /* Result Cards */
        .result-card {
            background: #1a1a2e; border-radius: 10px; padding: 15px; margin-bottom: 15px;
            border: 1px solid #3d3d54;
        }
        .result-card h4 { font-size: 14px; color: #888; margin-bottom: 10px; text-transform: uppercase; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
        .result-item { text-align: center; padding: 10px; background: #252542; border-radius: 8px; }
        .result-item .label { font-size: 11px; color: #888; margin-bottom: 4px; }
        .result-item .value { font-size: 18px; font-weight: 700; color: #22c55e; }
        .result-item .value.blue { color: #3b82f6; }
        .result-item .value.orange { color: #f59e0b; }
        .result-item .value.red { color: #ef4444; }
        
        /* Phase Table */
        .phase-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .phase-table th, .phase-table td {
            padding: 10px; text-align: left; border-bottom: 1px solid #3d3d54;
        }
        .phase-table th { color: #888; font-size: 12px; font-weight: 600; text-transform: uppercase; }
        .phase-table td { font-size: 14px; }
        .phase-table input {
            width: 80px; padding: 6px 8px; border-radius: 6px; border: 1px solid #3d3d54;
            background: #1a1a2e; color: #fff; font-size: 13px; text-align: right;
        }
        .phase-table .phase-name { color: #667eea; font-weight: 600; }
        .phase-table .phase-revenue { color: #22c55e; font-weight: 600; }
        
        /* Factsheet Preview */
        .factsheet-preview {
            background: white; color: #333; padding: 30px; border-radius: 8px;
            font-family: Arial, sans-serif; font-size: 14px;
        }
        .factsheet-preview h2 { color: #333; margin-bottom: 5px; }
        .factsheet-preview .event-name { color: #ef4444; font-weight: bold; }
        .factsheet-preview table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .factsheet-preview th, .factsheet-preview td {
            border: 1px solid #333; padding: 8px; text-align: left;
        }
        .factsheet-preview th { background: #f0f0f0; }
        
        /* Upcoming Events */
        .upcoming-events { margin-bottom: 20px; }
        .upcoming-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .upcoming-title { font-size: 18px; font-weight: 700; color: #fff; }
        .upcoming-week-label { font-size: 14px; font-weight: 600; color: #888; margin-bottom: 10px; padding-left: 5px; }
        .upcoming-week-label.current { color: #ef4444; }
        
        .event-card {
            background: linear-gradient(135deg, #252542 0%, #1a1a2e 100%);
            border-radius: 12px; margin-bottom: 12px; overflow: hidden; border: 1px solid #3d3d54;
        }
        .event-card-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; cursor: pointer; user-select: none;
        }
        .event-card-header:hover { background: rgba(255,255,255,0.03); }
        .event-main-info { display: flex; align-items: center; gap: 12px; }
        .event-date {
            background: #3d3d54; padding: 6px 10px; border-radius: 6px;
            font-weight: 700; font-size: 13px; min-width: 70px; text-align: center;
        }
        .event-name { font-weight: 600; font-size: 16px; }
        .event-tech { background: #757575; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .event-quick-stats { display: flex; align-items: center; gap: 15px; font-size: 13px; color: #888; }
        .event-toggle { color: #888; font-size: 12px; transition: transform 0.3s; }
        .event-card.open .event-toggle { transform: rotate(180deg); }
        .event-details { display: none; padding: 0 15px 15px 15px; border-top: 1px solid #3d3d54; }
        .event-card.open .event-details { display: block; }
        
        /* VVK Tracker */
        .vvk-tracker {
            background: linear-gradient(135deg, #1e3a5f 0%, #1a1a2e 100%);
            border: 1px solid #f59e0b; border-radius: 10px; padding: 12px 15px; margin-bottom: 12px;
        }
        .vvk-input-row { display: flex; align-items: center; gap: 6px; margin-bottom: 10px; flex-wrap: wrap; }
        .vvk-input-row label { font-size: 12px; font-weight: 600; color: #f59e0b; }
        .vvk-input-row input {
            width: 60px; padding: 6px 8px; border-radius: 6px; border: 1px solid #3d3d54;
            background: #1a1a2e; color: #fff; font-size: 14px; font-weight: 700; text-align: center;
        }
        .vvk-input-row input:focus { outline: none; border-color: #f59e0b; }
        .vvk-days { background: #3d3d54; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; color: #888; }
        .vvk-progress-bar { height: 8px; background: #3d3d54; border-radius: 4px; overflow: hidden; margin-bottom: 8px; }
        .vvk-progress { height: 100%; background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #22c55e 100%); border-radius: 4px; transition: width 0.3s ease; }
        .vvk-benchmark { font-size: 11px; color: #888; text-align: center; }
        
        .auto-projection {
            background: linear-gradient(135deg, #1e3a5f 0%, #1a1a2e 100%);
            border: 1px solid #3b82f6; border-radius: 10px; padding: 12px 15px; margin: 12px 0;
        }
        .projection-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
        .proj-box { background: #1a1a2e; padding: 10px; border-radius: 8px; text-align: center; }
        .proj-box-label { font-size: 10px; color: #888; margin-bottom: 3px; text-transform: uppercase; }
        .proj-box-value { font-size: 16px; font-weight: 700; color: #22c55e; }
        .proj-box-value.tickets { color: #3b82f6; }
        .proj-box-value.bar { color: #f59e0b; }
        .projection-basis { font-size: 11px; color: #888; text-align: center; padding-top: 8px; border-top: 1px solid #3d3d54; }
        
        .cvd-badge { display: inline-flex; align-items: center; gap: 5px; background: #43A047; color: white; padding: 5px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; margin: 10px 0; }
        
        .event-actions { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
        .event-action-btn {
            flex: 1; min-width: 100px; background: #3d3d54; border: none; border-radius: 8px;
            padding: 10px; color: white; font-size: 12px; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
        }
        .event-action-btn:hover { background: #4d4d64; }
        .event-action-btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        /* Toast */
        .toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #22c55e; color: white; padding: 12px 24px; border-radius: 8px;
            font-weight: 600; z-index: 1001; display: none;
        }
        .toast.show { display: block; animation: fadeInOut 3s ease; }
        .toast.error { background: #ef4444; }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        
        /* Departments */
        .departments { display: grid; gap: 15px; }
        .dept { border-radius: 15px; overflow: hidden; }
        .dept-header {
            padding: 15px 20px; color: white; font-weight: bold; font-size: 18px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .dept-header-left { display: flex; align-items: center; gap: 10px; }
        .task-count { background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 12px; font-size: 12px; }
        .office .dept-header { background: #1E88E5; }
        .office .dept-content { background: #E3F2FD; }
        .bar .dept-header { background: #F4511E; }
        .bar .dept-content { background: #FBE9E7; }
        .runner .dept-header { background: #43A047; }
        .runner .dept-content { background: #E8F5E9; }
        .technik .dept-header { background: #757575; }
        .technik .dept-content { background: #F5F5F5; }
        .sputnik .dept-header { background: #8E24AA; }
        .sputnik .dept-content { background: #F3E5F5; }
        .dept-content { padding: 15px; }
        
        .collapsible-section { margin-bottom: 10px; }
        .section-label {
            color: white; padding: 12px 15px; font-size: 14px; font-weight: bold;
            border-radius: 8px; cursor: pointer; display: flex;
            justify-content: space-between; align-items: center;
        }
        .section-label .toggle-icon { font-size: 12px; transition: transform 0.3s; }
        .section-label.open .toggle-icon { transform: rotate(180deg); }
        .section-label.open { border-radius: 8px 8px 0 0; }
        .office .section-label { background: #1E88E5; }
        .bar .section-label { background: #F4511E; }
        .runner .section-label { background: #43A047; }
        .sputnik .section-label { background: #8E24AA; }
        .technik .section-label { background: #757575; }
        .section-content { display: none; background: white; border-radius: 0 0 8px 8px; overflow: hidden; }
        .section-content.open { display: block; }
        .section-content iframe { width: 100%; height: 300px; border: none; }
        
        /* Tasks - Collapsible with black border */
        .tasks-inline { background: white; border-radius: 8px; margin-top: 10px; overflow: hidden; border: 2px solid #000; }
        .tasks-header { 
            padding: 12px 15px; font-size: 14px; font-weight: bold; color: #333; 
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; user-select: none; background: #f5f5f5;
        }
        .tasks-header:hover { background: #eee; }
        .tasks-header .toggle-icon { font-size: 12px; transition: transform 0.3s; margin-left: 8px; }
        .tasks-header.open .toggle-icon { transform: rotate(180deg); }
        .tasks-header .refresh-btn { background: none; border: none; cursor: pointer; font-size: 14px; color: #888; }
        .tasks-header .refresh-btn.spinning { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .tasks-list { max-height: 300px; overflow-y: auto; display: none; }
        .tasks-list.open { display: block; }
        .task-item { display: flex; align-items: center; gap: 10px; padding: 10px 15px; border-bottom: 1px solid #f0f0f0; }
        .task-checkbox { width: 20px; height: 20px; border: 2px solid #ccc; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .task-checkbox:hover { border-color: #22c55e; }
        .task-checkbox.checked { background: #22c55e; border-color: #22c55e; }
        .task-checkbox.checked::after { content: '‚úì'; color: white; font-size: 12px; }
        .task-info { flex: 1; }
        .task-title { font-size: 14px; color: #333; }
        .task-due { font-size: 11px; color: #888; }
        .task-due.overdue { color: #ef4444; }
        .task-importance { width: 6px; height: 6px; border-radius: 50%; background: #ccc; }
        .task-importance.high { background: #ef4444; }
        .tasks-empty { padding: 20px; text-align: center; color: #888; font-size: 13px; }
        .tasks-login-prompt { padding: 20px; text-align: center; color: #666; font-size: 13px; }
        .tasks-login-prompt button { margin-top: 10px; background: #0078d4; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
        
        .tasks-btn { color: white; padding: 12px; border-radius: 8px; font-size: 14px; text-align: center; display: block; width: 100%; font-weight: bold; margin-top: 10px; border: none; cursor: pointer; }
        .office .tasks-btn { background: #1E88E5; }
        .bar .tasks-btn { background: #F4511E; }
        .runner .tasks-btn { background: #43A047; }
        .sputnik .tasks-btn { background: #8E24AA; }
        .technik .tasks-btn { background: #757575; }
        
        .reinigung-list { padding: 8px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .reinigung-item { display: flex; padding: 6px 8px; background: #f5f5f5; border-radius: 6px; align-items: center; gap: 6px; justify-content: center; }
        .reinigung-date { font-weight: bold; font-size: 13px; color: #1E88E5; }
        .reinigung-type { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: white; }
        .reinigung-type.gross { background: #ef4444; }
        
        .calendar-list { padding: 8px; }
        .calendar-item { 
            display: flex; 
            padding: 10px 12px; 
            margin-bottom: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px; 
            align-items: center; 
            gap: 12px;
            border-left: 4px solid #757575;
        }
        .calendar-item:last-child { margin-bottom: 0; }
        .calendar-date { 
            font-weight: 700; 
            min-width: 65px; 
            font-size: 14px; 
            color: #333;
        }
        .calendar-day { 
            background: #757575;
            color: white;
            font-size: 11px; 
            font-weight: 700;
            padding: 3px 6px;
            border-radius: 4px;
            min-width: 28px;
            text-align: center;
        }
        .calendar-event { flex: 1; font-size: 15px; font-weight: 600; color: #333; }
        .calendar-tech { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 5px 12px; 
            border-radius: 6px; 
            font-size: 13px; 
            font-weight: 700;
        }
        .tag-club { background: #ef4444; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; margin-left: 8px; font-weight: 600; }
        .calendar-time { color: #666; font-size: 12px; min-width: 50px; }
        .calendar-pax { background: #8E24AA; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; }
        
        .footer { margin-top: 25px; text-align: center; }
        .footer a { background: #2d2d44; color: white; padding: 15px 30px; border-radius: 10px; text-decoration: none; display: inline-block; }
        .version { color: #555; font-size: 11px; text-align: center; margin-top: 15px; }
        
        .loading-spinner { text-align: center; padding: 40px; color: #888; }
        .loading-spinner::after { content: ''; display: inline-block; width: 20px; height: 20px; border: 2px solid #3d3d54; border-top-color: #0078d4; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px; }

        /* Quick Notes */
        .quick-notes {
            background: #252542; border-radius: 10px; padding: 12px 15px; margin-bottom: 15px;
            border: 1px solid #3d3d54;
        }
        .quick-notes-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
        }
        .quick-notes-header span { font-size: 13px; font-weight: 600; color: #f59e0b; }
        .quick-notes-header .save-indicator { font-size: 11px; color: #22c55e; opacity: 0; transition: opacity 0.3s; }
        .quick-notes-header .save-indicator.show { opacity: 1; }
        .quick-notes textarea {
            width: 100%; min-height: 60px; padding: 10px; border-radius: 8px;
            border: 1px solid #3d3d54; background: #1a1a2e; color: #fff;
            font-size: 13px; font-family: inherit; resize: vertical;
        }
        .quick-notes textarea:focus { outline: none; border-color: #f59e0b; }
        .quick-notes textarea::placeholder { color: #666; }
        
        /* Deep Analysis Button */
        .btn-analysis { background: linear-gradient(135deg, #ec4899 0%, #be185d 100%); }

        /* =========================================================================== */
        /* RESPONSIVE DESIGN */
        /* =========================================================================== */
        
        /* Tablet (max 768px) */
        @media screen and (max-width: 768px) {
            body { padding: 12px; }
            .header h1 { font-size: 24px; }
            
            .auth-bar { 
                flex-direction: column; 
                gap: 8px;
                padding: 12px;
            }
            .auth-btn { width: 100%; justify-content: center; }
            
            .quick-actions,
            .quick-actions-row2,
            .quick-actions-row3 { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 8px;
            }
            
            .quick-btn { 
                padding: 12px 8px; 
                font-size: 12px; 
            }
            
            .quick-notes textarea { min-height: 50px; }
            
            .modal { margin: 10px; max-width: calc(100% - 20px); }
            .modal-body { padding: 15px; max-height: 60vh; }
            .form-row { grid-template-columns: 1fr; }
            
            .event-card-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .event-quick-stats { width: 100%; justify-content: space-between; }
            
            .projection-grid { grid-template-columns: repeat(2, 1fr); }
            
            .vvk-input-row { 
                flex-wrap: wrap;
                gap: 8px;
            }
            .vvk-input-row label { font-size: 11px; }
            .vvk-input-row input { width: 55px; }
            
            .dept-header { font-size: 16px; padding: 12px 15px; }
            .section-content iframe { height: 250px; }
            
            .result-grid { grid-template-columns: repeat(2, 1fr); }
            
            .reinigung-list { grid-template-columns: repeat(2, 1fr); }
            
            .calendar-item { flex-wrap: wrap; gap: 8px; }
            .calendar-event { width: 100%; order: -1; }
        }
        
        /* Mobile (max 480px) */
        @media screen and (max-width: 480px) {
            body { padding: 8px; }
            .header h1 { font-size: 20px; }
            .header p { font-size: 12px; }
            
            .quick-actions,
            .quick-actions-row2,
            .quick-actions-row3 { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 6px;
            }
            
            .quick-btn { 
                padding: 10px 6px; 
                font-size: 11px;
                border-radius: 8px;
            }
            
            .quick-notes { padding: 10px; }
            .quick-notes-header span { font-size: 12px; }
            
            .event-card { margin-bottom: 10px; }
            .event-date { min-width: 60px; font-size: 12px; padding: 4px 8px; }
            .event-name { font-size: 14px; }
            .event-tech { font-size: 10px; padding: 2px 6px; }
            
            .projection-grid { grid-template-columns: repeat(2, 1fr); gap: 6px; }
            .proj-box { padding: 8px; }
            .proj-box-label { font-size: 9px; }
            .proj-box-value { font-size: 14px; }
            
            .vvk-tracker { padding: 10px; }
            .vvk-input-row input { width: 50px; font-size: 12px; padding: 4px 6px; }
            
            .modal-header { padding: 12px 15px; }
            .modal-header h3 { font-size: 16px; }
            .modal-body { padding: 12px; }
            .modal-footer { padding: 12px; flex-wrap: wrap; }
            .modal-btn { flex: 1; min-width: 80px; padding: 8px 12px; font-size: 12px; }
            
            .phase-table input { width: 60px; font-size: 12px; }
            
            .result-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
            .result-item { padding: 8px; }
            .result-item .label { font-size: 10px; }
            .result-item .value { font-size: 16px; }
            
            .dept-header { font-size: 14px; padding: 10px 12px; }
            .section-label { padding: 10px 12px; font-size: 13px; }
            .section-content iframe { height: 200px; }
            
            .tasks-header { padding: 10px 12px; font-size: 13px; }
            .task-item { padding: 8px 12px; }
            .task-title { font-size: 13px; }
            
            .reinigung-list { grid-template-columns: 1fr 1fr; gap: 4px; }
            .reinigung-item { padding: 4px 6px; }
            .reinigung-date { font-size: 11px; }
            
            .calendar-item { padding: 8px 10px; }
            .calendar-date { font-size: 12px; min-width: 55px; }
            .calendar-event { font-size: 13px; }
            .calendar-tech { font-size: 11px; padding: 3px 8px; }
            
            .footer a { padding: 12px 20px; font-size: 13px; }
            .version { font-size: 10px; }
            
            .factsheet-preview { padding: 15px; font-size: 12px; }
            .factsheet-preview table { font-size: 11px; }
            .factsheet-preview th, 
            .factsheet-preview td { padding: 5px; }
        }
        
        /* Large Desktop (min 1200px) */
        @media screen and (min-width: 1200px) {
            .departments { 
                display: grid; 
                grid-template-columns: repeat(2, 1fr); 
                gap: 20px; 
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ TURBO-PROJECTS</h1>
        <p>Work Hub Launcher</p>
    </div>
    
    <!-- Auth Bar -->
    <div class="auth-bar">
        <div class="auth-status">
            <span class="dot" id="auth-dot"></span>
            <span id="auth-status-text">Not connected</span>
        </div>
        <span class="auth-user" id="auth-user"></span>
        <button class="auth-btn" id="auth-btn" onclick="handleAuth()">
            <span>üîê</span> Sign in with Microsoft
        </button>
        <button class="auth-btn" onclick="forceResetAuth()" title="Cache l√∂schen & neu verbinden" style="padding: 8px 12px; margin-left: 5px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
            üîÑ Reset
        </button>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <!-- Quick Notes -->
    <div class="quick-notes">
        <div class="quick-notes-header">
            <span>üìù Quick Notes</span>
            <span class="save-indicator" id="notes-saved">‚úì Gespeichert</span>
        </div>
        <textarea id="quick-notes-text" placeholder="Schnelle Notizen hier eingeben..." oninput="saveQuickNotes()"></textarea>
    </div>
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- MODALS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <!-- PreSale Calculator Modal -->
    <div class="modal-overlay" id="presale-modal">
        <div class="modal">
            <div class="modal-header orange">
                <h3>üéüÔ∏è PreSale Calculator</h3>
                <button class="modal-close" onclick="closeModal('presale-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Event Name</label>
                        <input type="text" id="ps-event-name" placeholder="z.B. TURBO">
                    </div>
                    <div class="form-group">
                        <label>FOH Tickets (gesch√§tzt)</label>
                        <input type="number" id="ps-foh-tickets" value="350" oninput="calculatePreSale()">
                    </div>
                    <div class="form-group">
                        <label>FOH Preis (‚Ç¨)</label>
                        <input type="number" id="ps-door-price" value="22" oninput="calculatePreSale()">
                    </div>
                </div>
                
                <h4 style="color: #f59e0b; margin: 20px 0 10px;">Phasen-Struktur</h4>
                <table class="phase-table">
                    <thead>
                        <tr>
                            <th>Phase</th>
                            <th>Tickets</th>
                            <th>Preis (‚Ç¨)</th>
                            <th>Revenue</th>
                        </tr>
                    </thead>
                    <tbody id="ps-phases-body">
                        <tr>
                            <td class="phase-name">Early Bird</td>
                            <td><input type="number" class="ps-tickets" value="100" oninput="calculatePreSale()"></td>
                            <td><input type="number" class="ps-price" value="18" oninput="calculatePreSale()"></td>
                            <td class="phase-revenue">‚Ç¨1.800</td>
                        </tr>
                        <tr>
                            <td class="phase-name">Phase 1</td>
                            <td><input type="number" class="ps-tickets" value="150" oninput="calculatePreSale()"></td>
                            <td><input type="number" class="ps-price" value="20" oninput="calculatePreSale()"></td>
                            <td class="phase-revenue">‚Ç¨3.000</td>
                        </tr>
                        <tr>
                            <td class="phase-name">Phase 2</td>
                            <td><input type="number" class="ps-tickets" value="150" oninput="calculatePreSale()"></td>
                            <td><input type="number" class="ps-price" value="22" oninput="calculatePreSale()"></td>
                            <td class="phase-revenue">‚Ç¨3.300</td>
                        </tr>
                        <tr>
                            <td class="phase-name">Phase 3</td>
                            <td><input type="number" class="ps-tickets" value="80" oninput="calculatePreSale()"></td>
                            <td><input type="number" class="ps-price" value="24" oninput="calculatePreSale()"></td>
                            <td class="phase-revenue">‚Ç¨1.920</td>
                        </tr>
                        <tr>
                            <td class="phase-name">Phase 4</td>
                            <td><input type="number" class="ps-tickets" value="0" oninput="calculatePreSale()"></td>
                            <td><input type="number" class="ps-price" value="26" oninput="calculatePreSale()"></td>
                            <td class="phase-revenue">‚Ç¨0</td>
                        </tr>
                        <tr>
                            <td class="phase-name">Phase 5</td>
                            <td><input type="number" class="ps-tickets" value="0" oninput="calculatePreSale()"></td>
                            <td><input type="number" class="ps-price" value="28" oninput="calculatePreSale()"></td>
                            <td class="phase-revenue">‚Ç¨0</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="result-card" style="margin-top: 20px;">
                    <h4>üìä Ergebnis</h4>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">VVK Tickets</div>
                            <div class="value blue" id="ps-result-vvk">480</div>
                        </div>
                        <div class="result-item">
                            <div class="label">VVK Revenue</div>
                            <div class="value" id="ps-result-vvk-rev">‚Ç¨10.020</div>
                        </div>
                        <div class="result-item">
                            <div class="label">√ò VVK Preis</div>
                            <div class="value orange" id="ps-result-avg">‚Ç¨20.88</div>
                        </div>
                        <div class="result-item">
                            <div class="label">FOH Tickets</div>
                            <div class="value blue" id="ps-result-foh">320</div>
                        </div>
                        <div class="result-item">
                            <div class="label">FOH Revenue</div>
                            <div class="value" id="ps-result-foh-rev">‚Ç¨8.000</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Total Revenue</div>
                            <div class="value" id="ps-result-total">‚Ç¨18.020</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('presale-modal')">Schlie√üen</button>
            </div>
        </div>
    </div>
    
    <!-- Cost Calculator Modal -->
    <div class="modal-overlay" id="cost-modal">
        <div class="modal">
            <div class="modal-header purple">
                <h3>üßÆ Cost Calculator</h3>
                <button class="modal-close" onclick="closeModal('cost-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Event Name</label>
                        <input type="text" id="cc-event-name" placeholder="z.B. TURBO">
                    </div>
                    <div class="form-group">
                        <label>Erwartete G√§ste</label>
                        <input type="number" id="cc-guests" value="800" oninput="calculateCosts()">
                    </div>
                </div>
                
                <h4 style="color: #8b5cf6; margin: 20px 0 10px;">üí∞ Einnahmen (Projektion)</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ticket Revenue (‚Ç¨)</label>
                        <input type="number" id="cc-ticket-rev" value="18000" oninput="calculateCosts()">
                    </div>
                    <div class="form-group">
                        <label>Bar Revenue (‚Ç¨)</label>
                        <input type="number" id="cc-bar-rev" value="12000" oninput="calculateCosts()">
                    </div>
                </div>
                
                <h4 style="color: #8b5cf6; margin: 20px 0 10px;">üë• Personal</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Bar Team (Personen)</label>
                        <input type="number" id="cc-bar-staff" value="4" oninput="calculateCosts()">
                    </div>
                    <div class="form-group">
                        <label>Runner Team (Personen)</label>
                        <input type="number" id="cc-runner-staff" value="5" oninput="calculateCosts()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Garderobe (Personen)</label>
                        <input type="number" id="cc-garderobe-staff" value="3" oninput="calculateCosts()">
                    </div>
                    <div class="form-group">
                        <label>Security (Personen)</label>
                        <input type="number" id="cc-security-staff" value="7" oninput="calculateCosts()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Techniker (Personen)</label>
                        <input type="number" id="cc-tech-staff" value="1" oninput="calculateCosts()">
                    </div>
                    <div class="form-group">
                        <label>CVD (Personen)</label>
                        <input type="number" id="cc-cvd-staff" value="1" oninput="calculateCosts()">
                    </div>
                </div>
                
                <h4 style="color: #8b5cf6; margin: 20px 0 10px;">üì¶ Fixkosten</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Artist Fee (‚Ç¨)</label>
                        <input type="number" id="cc-artist" value="2000" oninput="calculateCosts()">
                    </div>
                    <div class="form-group">
                        <label>GEMA/AKM (‚Ç¨)</label>
                        <input type="number" id="cc-gema" value="500" oninput="calculateCosts()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Marketing (‚Ç¨)</label>
                        <input type="number" id="cc-marketing" value="300" oninput="calculateCosts()">
                    </div>
                    <div class="form-group">
                        <label>Sonstiges (‚Ç¨)</label>
                        <input type="number" id="cc-other" value="200" oninput="calculateCosts()">
                    </div>
                </div>
                
                <div class="result-card" style="margin-top: 20px;">
                    <h4>üìä Kalkulation</h4>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">Total Einnahmen</div>
                            <div class="value" id="cc-result-revenue">‚Ç¨30.000</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Personalkosten</div>
                            <div class="value red" id="cc-result-staff">‚Ç¨3.150</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Fixkosten</div>
                            <div class="value red" id="cc-result-fixed">‚Ç¨3.000</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Total Kosten</div>
                            <div class="value red" id="cc-result-costs">‚Ç¨6.150</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Deckungsbeitrag</div>
                            <div class="value" id="cc-result-profit">‚Ç¨23.850</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Marge</div>
                            <div class="value" id="cc-result-margin">79.5%</div>
                        </div>
                    </div>
                </div>
                <p class="form-hint" style="margin-top: 10px;">‚ö†Ô∏è Personalkosten-Logik wird noch angepasst. Aktuelle Pauschalen: Bar ‚Ç¨150, Runner ‚Ç¨120, Garderobe ‚Ç¨100, Security ‚Ç¨180, Technik ‚Ç¨200, CVD ‚Ç¨150</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('cost-modal')">Schlie√üen</button>
            </div>
        </div>
    </div>
    
    <!-- Event Projector Modal -->
    <div class="modal-overlay" id="projector-modal">
        <div class="modal">
            <div class="modal-header green">
                <h3>üìä Event Projector</h3>
                <button class="modal-close" onclick="closeModal('projector-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Event Serie</label>
                        <select id="ep-serie" onchange="updateProjectorData()">
                            <option value="turbo">TURBO</option>
                            <option value="selected">Selected</option>
                            <option value="halloween">Halloween</option>
                            <option value="birthday">Birthday</option>
                            <option value="nye">NYE / Silvester</option>
                            <option value="special">Special Events</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Kalenderwoche</label>
                        <select id="ep-kw" onchange="updateProjectorData()">
                            <option value="49">KW 49</option>
                            <option value="50">KW 50</option>
                            <option value="51">KW 51</option>
                            <option value="52" selected>KW 52</option>
                            <option value="1">KW 1</option>
                            <option value="2">KW 2</option>
                        </select>
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>üìà Serie Durchschnitt</h4>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">√ò VVK</div>
                            <div class="value blue" id="ep-avg-vvk">436</div>
                        </div>
                        <div class="result-item">
                            <div class="label">√ò FOH</div>
                            <div class="value blue" id="ep-avg-foh">336</div>
                        </div>
                        <div class="result-item">
                            <div class="label">√ò Total</div>
                            <div class="value blue" id="ep-avg-total">772</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Events</div>
                            <div class="value orange" id="ep-events">25</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>üç∫ KW Bar-Statistik</h4>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">‚Ç¨/Person</div>
                            <div class="value orange" id="ep-bar-pp">‚Ç¨16.3</div>
                        </div>
                        <div class="result-item">
                            <div class="label">√ò Bar Revenue</div>
                            <div class="value" id="ep-bar-rev">‚Ç¨12.584</div>
                        </div>
                        <div class="result-item">
                            <div class="label">√ò Total G√§ste</div>
                            <div class="value blue" id="ep-bar-guests">772</div>
                        </div>
                    </div>
                </div>
                
                <h4 style="color: #22c55e; margin: 20px 0 10px;">üéØ Projektion mit aktuellem VVK</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Aktueller VVK Stand</label>
                        <input type="number" id="ep-current-vvk" value="0" oninput="updateProjectorProjection()">
                    </div>
                    <div class="form-group">
                        <label>Tage bis Event</label>
                        <input type="number" id="ep-days" value="7" oninput="updateProjectorProjection()">
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>üîÆ Projektion</h4>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="label">VVK Projektion</div>
                            <div class="value blue" id="ep-proj-vvk">~436</div>
                        </div>
                        <div class="result-item">
                            <div class="label">FOH Projektion</div>
                            <div class="value blue" id="ep-proj-foh">~336</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Bar Projektion</div>
                            <div class="value orange" id="ep-proj-bar">~‚Ç¨12.6k</div>
                        </div>
                        <div class="result-item">
                            <div class="label">Total Revenue</div>
                            <div class="value" id="ep-proj-total">~‚Ç¨28k</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('projector-modal')">Schlie√üen</button>
            </div>
        </div>
    </div>
    
    <!-- Factsheet Generator Modal -->
    <div class="modal-overlay" id="factsheet-modal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3>üìÑ Factsheet Generator</h3>
                <button class="modal-close" onclick="closeModal('factsheet-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Event ausw√§hlen</label>
                        <select id="fs-event-select" onchange="loadEventData()">
                            <option value="">-- Event w√§hlen --</option>
                            <option value="turbo">TURBO - Sa 27.12.2025</option>
                            <option value="nye">NYE SILVESTER - Di 31.12.2025</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Event Typ</label>
                        <select id="fs-template" onchange="updateFactsheetPreview()">
                            <option value="CLUB">Club Night</option>
                            <option value="CONCERT">Concert (Early Doors)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row" id="main-floor-row">
                    <div class="form-group">
                        <label>Main Floor √ñffnung</label>
                        <div style="display: flex; gap: 15px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; color: #fff;">
                                <input type="radio" name="main-floor-time" value="00:00" checked onchange="updateFactsheetPreview()"> 
                                <span>00:00</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; color: #fff;">
                                <input type="radio" name="main-floor-time" value="00:30" onchange="updateFactsheetPreview()"> 
                                <span>00:30</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Event Name</label>
                        <input type="text" id="fs-event-name" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>Datum</label>
                        <input type="text" id="fs-datum" value="" oninput="updateFactsheetPreview()">
                    </div>
                </div>
                
                <h4 style="color: #667eea; margin: 20px 0 10px;">üë• Personal</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>CVD</label>
                        <input type="text" id="fs-cvd" value="Alain" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>Technik</label>
                        <input type="text" id="fs-technik" value="Simon" oninput="updateFactsheetPreview()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>TERRASSE</label>
                        <input type="text" id="fs-terrasse" value="-" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>KITCHEN</label>
                        <input type="text" id="fs-kitchen" value="" oninput="updateFactsheetPreview()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>MAIN 1</label>
                        <input type="text" id="fs-main1" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>MAIN 2</label>
                        <input type="text" id="fs-main2" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>MAIN 3</label>
                        <input type="text" id="fs-main3" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>MAIN 4</label>
                        <input type="text" id="fs-main4" value="" oninput="updateFactsheetPreview()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>RUNNER 1</label>
                        <input type="text" id="fs-runner1" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>RUNNER 2</label>
                        <input type="text" id="fs-runner2" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>RUNNER 3</label>
                        <input type="text" id="fs-runner3" value="" oninput="updateFactsheetPreview()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>RUNNER 4</label>
                        <input type="text" id="fs-runner4" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>RUNNER 5</label>
                        <input type="text" id="fs-runner5" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>RUNNER 6</label>
                        <input type="text" id="fs-runner6" value="" oninput="updateFactsheetPreview()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>GARDEROBE 1</label>
                        <input type="text" id="fs-gard1" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>GARDEROBE 2</label>
                        <input type="text" id="fs-gard2" value="" oninput="updateFactsheetPreview()">
                    </div>
                    <div class="form-group">
                        <label>GARDEROBE 3</label>
                        <input type="text" id="fs-gard3" value="" oninput="updateFactsheetPreview()">
                    </div>
                </div>
                
                <h4 style="color: #667eea; margin: 20px 0 10px;">üëÄ Preview</h4>
                <div class="factsheet-preview" id="fs-preview">
                    <!-- Generated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('factsheet-modal')">Schlie√üen</button>
                <button class="modal-btn primary" onclick="copyFactsheet()">üìã Kopieren</button>
                <button class="modal-btn success" onclick="printFactsheet()">üñ®Ô∏è Drucken</button>
            </div>
        </div>
    </div>

    <!-- Email Composer Modal -->
    <div class="modal-overlay" id="email-modal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);">
                <h3>‚úâÔ∏è E-Mail senden</h3>
                <button class="modal-close" onclick="closeModal('email-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>An (E-Mail)</label>
                    <input type="email" id="email-to" placeholder="empfaenger@example.com">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>Betreff</label>
                    <input type="text" id="email-subject" placeholder="Betreff eingeben...">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>Nachricht</label>
                    <textarea id="email-body" rows="8" placeholder="Nachricht eingeben..." style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #3d3d54; background: #1a1a2e; color: #fff; font-family: inherit; resize: vertical;"></textarea>
                </div>
                <p class="form-hint" id="email-status" style="color: #888; font-size: 12px;"></p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('email-modal')">Abbrechen</button>
                <button class="modal-btn primary" onclick="sendEmail()">üì§ Senden</button>
            </div>
        </div>
    </div>

    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- QUICK ACTIONS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <div class="quick-actions">
        <button class="quick-btn btn-factsheet" onclick="openModal('factsheet-modal')">üìÑ Factsheet</button>
        <button class="quick-btn btn-email" onclick="openModal('email-modal')">‚úâÔ∏è E-Mail</button>
        <a href="https://drive.google.com/drive/folders/1w7spIO25kEPGOfv1MLi73fMfKapemKB9" class="quick-btn btn-graphics" target="_blank">üìÅ Graphics</a>
        <a href="https://club.bookmetender.com/dashboards" class="quick-btn" target="_blank">üìñ BMT</a>
    </div>
    
    <div class="quick-actions-row2">
        <div class="dropdown-container">
            <button class="quick-btn dropdown-btn" onclick="toggleDropdown('social-dropdown')">üì± Social ‚ñº</button>
            <div id="social-dropdown" class="dropdown-content">
                <a href="https://www.instagram.com/grelle_forelle/" class="dropdown-item" target="_blank"><span class="icon">üì∏</span> Instagram</a>
                <a href="https://www.facebook.com/GrelleForelle/" class="dropdown-item" target="_blank"><span class="icon">üìò</span> Facebook</a>
            </div>
        </div>
        <div class="dropdown-container">
            <button class="quick-btn dropdown-btn sales" onclick="toggleDropdown('sales-dropdown')">üí∞ Sales ‚ñº</button>
            <div id="sales-dropdown" class="dropdown-content">
                <a href="https://wbv.azurewebsites.net/default.aspx" class="dropdown-item" target="_blank"><span class="icon">üí≥</span> WBV (POS)</a>
                <a href="https://linktr.ee/grelletickets" class="dropdown-item" target="_blank"><span class="icon">üîó</span> Linktree</a>
                <a href="https://ntry.at/my/events?l=de" class="dropdown-item" target="_blank"><span class="icon">üéüÔ∏è</span> ntry (Pre-Sale)</a>
            </div>
        </div>
        <div class="dropdown-container">
            <button class="quick-btn dropdown-btn" onclick="toggleDropdown('storage-dropdown')" style="background: linear-gradient(135deg, #4285f4 0%, #0d47a1 100%);">üìÅ Storage ‚ñº</button>
            <div id="storage-dropdown" class="dropdown-content">
                <a href="https://drive.google.com/drive/my-drive" class="dropdown-item" target="_blank"><span class="icon">üü°</span> Google Drive</a>
                <a href="https://onedrive.live.com" class="dropdown-item" target="_blank"><span class="icon">üîµ</span> OneDrive</a>
            </div>
        </div>
        <a href="https://wa.me/" class="quick-btn" style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);" target="_blank">üí¨ WhatsApp</a>
    </div>
    
    <div class="quick-actions-row3">
        <button class="quick-btn btn-presale" onclick="openModal('presale-modal')">üéüÔ∏è PreSale Calc</button>
        <button class="quick-btn btn-calculator" onclick="openModal('cost-modal')">üßÆ Cost Calc</button>
        <button class="quick-btn btn-projector" onclick="openModal('projector-modal')">üìä Projector</button>
        <button class="quick-btn btn-analysis" onclick="openDeepAnalysis()">üî¨ Deep Analysis</button>
    </div>
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- OUTLOOK SECTION -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- UPCOMING EVENTS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <div class="upcoming-events">
        <div class="upcoming-header">
            <span class="upcoming-title">üìÖ UPCOMING EVENTS</span>
        </div>
        <div class="upcoming-week-label current">üî¥ DIESE WOCHE (KW 52)</div>
        
        <!-- TURBO -->
        <div class="event-card" id="event-turbo27">
            <div class="event-card-header" onclick="toggleEventCard('event-turbo27')">
                <div class="event-main-info">
                    <span class="event-date">SA 27.12</span>
                    <span class="event-name">TURBO</span>
                    <span class="event-tech">Simon</span>
                </div>
                <div class="event-quick-stats">
                    <span id="turbo-bar-quick">üç∫ ~‚Ç¨14.5k</span>
                    <span id="turbo-tickets-quick">üé´ ~763</span>
                    <span class="event-toggle">‚ñº</span>
                </div>
            </div>
            <div class="event-details">
                <div class="vvk-tracker">
                    <div class="vvk-input-row">
                        <label>üéØ Ziel:</label>
                        <input type="number" id="turbo-ziel-input" value="450" oninput="updateProjection('turbo')">
                        <label>üìä Max:</label>
                        <input type="number" id="turbo-max-input" value="600" oninput="updateProjection('turbo')">
                        <label>üé´ Aktuell:</label>
                        <input type="number" id="turbo-vvk-input" placeholder="0" oninput="updateProjection('turbo')">
                        <span class="vvk-days" id="turbo-days">4 Tage</span>
                    </div>
                    <div class="vvk-input-row">
                        <label>üí∂ √ò VVK ‚Ç¨:</label>
                        <input type="number" id="turbo-vvk-price" value="18" oninput="updateProjection('turbo')">
                        <label>üö™ FOH ‚Ç¨:</label>
                        <input type="number" id="turbo-foh-price" value="22" oninput="updateProjection('turbo')">
                    </div>
                    <div class="vvk-progress-bar">
                        <div class="vvk-progress" id="turbo-progress" style="width: 0%"></div>
                    </div>
                    <div class="vvk-benchmark" id="turbo-benchmark">Ziel: 450 | 55% bei 5d ‚Üí Soll ~248</div>
                </div>
                <div class="auto-projection">
                    <div class="projection-grid">
                        <div class="proj-box">
                            <div class="proj-box-label">VVK Proj.</div>
                            <div class="proj-box-value tickets" id="turbo-vvk-proj">~426</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">FOH Proj.</div>
                            <div class="proj-box-value tickets" id="turbo-foh-proj">~337</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Bar Proj.</div>
                            <div class="proj-box-value bar" id="turbo-bar-proj">~‚Ç¨14.5k</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Total Rev</div>
                            <div class="proj-box-value" id="turbo-total-proj">~‚Ç¨29.8k</div>
                        </div>
                    </div>
                    <div class="projection-basis" id="turbo-basis">üìä TURBO √ò: 436 VVK, 336 FOH | KW52: ‚Ç¨16.3/Person</div>
                </div>
                <div class="cvd-badge">üëî CVD: Alain</div>
                <div class="event-actions">
                    <button class="event-action-btn primary" onclick="autoFactsheetForEvent('turbo')">üìÑ Factsheet</button>
                </div>
            </div>
        </div>
        
        <!-- NYE -->
        <div class="event-card" id="event-silvester">
            <div class="event-card-header" onclick="toggleEventCard('event-silvester')">
                <div class="event-main-info">
                    <span class="event-date">DI 31.12</span>
                    <span class="event-name">SILVESTER</span>
                    <span class="event-tech">Jan</span>
                </div>
                <div class="event-quick-stats">
                    <span id="nye-bar-quick">üç∫ ~‚Ç¨23k</span>
                    <span id="nye-tickets-quick">üé´ ~1153</span>
                    <span class="event-toggle">‚ñº</span>
                </div>
            </div>
            <div class="event-details">
                <div class="vvk-tracker">
                    <div class="vvk-input-row">
                        <label>üéØ Ziel:</label>
                        <input type="number" id="nye-ziel-input" value="450" oninput="updateProjection('nye')">
                        <label>üìä Max:</label>
                        <input type="number" id="nye-max-input" value="700" oninput="updateProjection('nye')">
                        <label>üé´ Aktuell:</label>
                        <input type="number" id="nye-vvk-input" placeholder="0" oninput="updateProjection('nye')">
                        <span class="vvk-days" id="nye-days">8 Tage</span>
                    </div>
                    <div class="vvk-input-row">
                        <label>üí∂ √ò VVK ‚Ç¨:</label>
                        <input type="number" id="nye-vvk-price" value="25" oninput="updateProjection('nye')">
                        <label>üö™ FOH ‚Ç¨:</label>
                        <input type="number" id="nye-foh-price" value="26" oninput="updateProjection('nye')">
                    </div>
                    <div class="vvk-progress-bar">
                        <div class="vvk-progress" id="nye-progress" style="width: 0%"></div>
                    </div>
                    <div class="vvk-benchmark" id="nye-benchmark">Ziel: 450 | 40% bei 9d ‚Üí Soll ~180</div>
                </div>
                <div class="auto-projection">
                    <div class="projection-grid">
                        <div class="proj-box">
                            <div class="proj-box-label">VVK Proj.</div>
                            <div class="proj-box-value tickets" id="nye-vvk-proj">~522</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">FOH Proj.</div>
                            <div class="proj-box-value tickets" id="nye-foh-proj">~631</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Bar Proj.</div>
                            <div class="proj-box-value bar" id="nye-bar-proj">~‚Ç¨23k</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Total Rev</div>
                            <div class="proj-box-value" id="nye-total-proj">~‚Ç¨46k</div>
                        </div>
                    </div>
                    <div class="projection-basis" id="nye-basis">üìä NYE √ò: 562 VVK, 649 FOH | KW52: ‚Ç¨16.3/Person</div>
                </div>
                <div class="cvd-badge">üëî CVD: Alain / Niat</div>
                <div class="event-actions">
                    <button class="event-action-btn primary" onclick="autoFactsheetForEvent('nye')">üìÑ Factsheet</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- DEPARTMENTS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    
    <div class="departments">
        <!-- OFFICE -->
        <div class="dept office">
            <div class="dept-header">
                <div class="dept-header-left">üíº OFFICE</div>
                <span class="task-count" id="office-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üßπ Reinigungsplan</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="reinigung-list">
                            <div class="reinigung-item"><span class="reinigung-date">02.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">07.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">10.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">14.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">17.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">21.01</span><span class="reinigung-type gross">GROSS</span></div>
                        </div>
                    </div>
                </div>
                <div class="tasks-inline" id="office-tasks">
                    <div class="tasks-header" onclick="toggleTasksSection('office')">
                        <span>üìù Tasks <span class="toggle-icon">‚ñº</span></span>
                        <button class="refresh-btn" onclick="event.stopPropagation(); refreshTasks('office')">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="office-tasks-list">
                        <div class="tasks-login-prompt">
                            <p>Sign in to see your tasks</p>
                            <button onclick="handleAuth()">üîê Connect</button>
                        </div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('office')">üìù Open in To Do</button>
            </div>
        </div>
        
        <!-- BAR -->
        <div class="dept bar">
            <div class="dept-header">
                <div class="dept-header-left">üç∑ BAR</div>
                <span class="task-count" id="bar-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìã Shiftplan</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <iframe src="https://docs.google.com/document/d/e/2PACX-1vQLF5-vQFf1CZ2tEyVyVdD7uO088yl8CWDlQdWa61m0uhEbOB9FWuDU2wVBkJH_XxJMW_B01QOKFyAr/pub?embedded=true" style="height:400px;"></iframe>
                    </div>
                </div>
                <div class="tasks-inline" id="bar-tasks">
                    <div class="tasks-header" onclick="toggleTasksSection('bar')">
                        <span>üìù Tasks <span class="toggle-icon">‚ñº</span></span>
                        <button class="refresh-btn" onclick="event.stopPropagation(); refreshTasks('bar')">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="bar-tasks-list">
                        <div class="tasks-login-prompt"><p>Sign in to see tasks</p><button onclick="handleAuth()">üîê Connect</button></div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('bar')">üìù Open in To Do</button>
            </div>
        </div>
        
        <!-- RUNNER -->
        <div class="dept runner">
            <div class="dept-header">
                <div class="dept-header-left">üèÉ RUNNER</div>
                <span class="task-count" id="runner-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìã Shiftplan</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <iframe src="https://docs.google.com/document/d/e/2PACX-1vQf_QmeV8FxX-7zYGW1qi1t0D9WJjEk47bYCbXBGey4qAbDY5dU3yw_ByQ6jY1r59sUFlS_8NmCy3jl/pub?embedded=true" style="height:400px;"></iframe>
                    </div>
                </div>
                <div class="tasks-inline" id="runner-tasks">
                    <div class="tasks-header" onclick="toggleTasksSection('runner')">
                        <span>üìù Tasks <span class="toggle-icon">‚ñº</span></span>
                        <button class="refresh-btn" onclick="event.stopPropagation(); refreshTasks('runner')">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="runner-tasks-list">
                        <div class="tasks-login-prompt"><p>Sign in to see tasks</p><button onclick="handleAuth()">üîê Connect</button></div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('runner')">üìù Open in To Do</button>
            </div>
        </div>
        
        <!-- TECHNIK -->
        <div class="dept technik">
            <div class="dept-header">
                <div class="dept-header-left">üîß TECHNIK</div>
                <span class="task-count" id="technik-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label open" onclick="toggleSection(this)">
                        <span>üìÖ Technikerkalender</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content open">
                        <div class="calendar-list">
                            <div class="calendar-item">
                                <span class="calendar-date">27. Dez</span>
                                <span class="calendar-day">SA</span>
                                <span class="calendar-event">TURBO<span class="tag-club">Club</span></span>
                                <span class="calendar-tech">Simon</span>
                            </div>
                            <div class="calendar-item">
                                <span class="calendar-date">31. Dez</span>
                                <span class="calendar-day">DI</span>
                                <span class="calendar-event">Silvester<span class="tag-club">Club</span></span>
                                <span class="calendar-tech">Jan</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tasks-inline" id="technik-tasks">
                    <div class="tasks-header" onclick="toggleTasksSection('technik')">
                        <span>üìù Tasks <span class="toggle-icon">‚ñº</span></span>
                        <button class="refresh-btn" onclick="event.stopPropagation(); refreshTasks('technik')">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="technik-tasks-list">
                        <div class="tasks-login-prompt"><p>Sign in to see tasks</p><button onclick="handleAuth()">üîê Connect</button></div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('technik')">üìù Open in To Do</button>
            </div>
        </div>
        
        <!-- SPUTNIK -->
        <div class="dept sputnik">
            <div class="dept-header">
                <div class="dept-header-left">üç∏ SPUTNIK BAR</div>
                <span class="task-count" id="sputnik-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìã Shiftplan</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <iframe src="https://docs.google.com/document/d/e/2PACX-1vTayJTFCmEUh8Nh3QWQS6EfC15Q0dHBpc8GH_iC8A-yOlqIn6ARYW5XF0TmGQnWWgKqqfDMQp19i7iw/pub?embedded=true" style="height:400px;"></iframe>
                    </div>
                </div>
                <div class="tasks-inline" id="sputnik-tasks">
                    <div class="tasks-header" onclick="toggleTasksSection('sputnik')">
                        <span>üìù Tasks <span class="toggle-icon">‚ñº</span></span>
                        <button class="refresh-btn" onclick="event.stopPropagation(); refreshTasks('sputnik')">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="sputnik-tasks-list">
                        <div class="tasks-login-prompt"><p>Sign in to see tasks</p><button onclick="handleAuth()">üîê Connect</button></div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('sputnik')">üìù Open in To Do</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <a href="https://to-do.live.com" target="_blank">‚úÖ Open Microsoft To Do</a>
    </div>
    
    <div class="version">Work Hub v13.2 ‚Ä¢ 24.12.2025 ‚Ä¢ Responsive + Capacity Caps + Quick Notes</div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MSAL CONFIG
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const msalConfig = {
            auth: {
                clientId: "0fc00e3e-4ff3-4806-ae4a-222d1abee84b",
                authority: "https://login.microsoftonline.com/common",
                redirectUri: window.location.origin + window.location.pathname
            },
            cache: { cacheLocation: "localStorage", storeAuthStateInCookie: false }
        };
        
        const loginRequest = { scopes: ["Tasks.ReadWrite", "User.Read", "Mail.Send"] };
        
        const TODO_LISTS = {
            office: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqn88jwAAAA==",
            bar: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E7QAAAA==",
            runner: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E7gAAAA==",
            technik: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E7wAAAA==",
            sputnik: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E8AAAAA=="
        };
        
        let msalInstance = null;
        let accessToken = null;
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DATA
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const SERIE_STATS = {
            turbo: { avgVVK: 436, avgFOH: 336, avgTotal: 772, barPP: 15.3, events: 25 },
            selected: { avgVVK: 416, avgFOH: 336, avgTotal: 752, barPP: 16.9, events: 9 },
            halloween: { avgVVK: 527, avgFOH: 489, avgTotal: 1016, barPP: 16.4, events: 4 },
            birthday: { avgVVK: 499, avgFOH: 427, avgTotal: 926, barPP: 17.2, events: 7 },
            nye: { avgVVK: 562, avgFOH: 649, avgTotal: 1211, barPP: 19.5, events: 1 },
            special: { avgVVK: 457, avgFOH: 373, avgTotal: 830, barPP: 17.5, events: 11 }
        };
        
        const KW_STATS = {
            49: { barPP: 16.9 }, 50: { barPP: 17.0 }, 51: { barPP: 17.3 },
            52: { barPP: 16.3 }, 1: { barPP: 17.7 }, 2: { barPP: 16.5 }
        };
        
        const VVK_BENCHMARKS = { 14: 0.35, 10: 0.42, 7: 0.50, 5: 0.55, 3: 0.65, 2: 0.72, 1: 0.80, 0: 0.85 };
        
        // Capacity Caps (basierend auf historischen Daten - 76 Events)
        const CAPACITY_CAPS = {
            MAX_VVK: 600,      // Historisch max: 573
            MAX_FOH: 700,      // Historisch max: 649
            MAX_TOTAL: 1250    // Historisch max: 1211
        };
        
        const EVENT_CONFIG = {
            turbo: { date: new Date('2025-12-27'), serie: 'turbo', kw: 52 },
            nye: { date: new Date('2025-12-31'), serie: 'nye', kw: 52 }
        };
        
        const TEMPLATES = {
            MAIN_00: {
                doors1: "23:00", terrasse: "22:00", doors2_early: "23:00", kitchen: "22:00",
                doors2_late: "00:00", main1: "23:00", main2: "23:00", main3: "00:00", main4: "00:15",
                runner1: "21:00", runner2: "21:00", runner3: "21:00", runner4: "22:00", runner5: "00:00", runner6: "00:00",
                gard1: "22:45", gard2: "23:00", gard3: "00:15", technik: "21:00",
                security: [{ time: "22:45", pax: "1 PAX" }, { time: "23:00", pax: "1 PAX" }, { time: "23:30", pax: "1 PAX" }, { time: "00:00", pax: "3 PAX" }, { time: "01:00", pax: "1 PAX (Abruf)" }]
            },
            MAIN_30: {
                doors1: "23:00", terrasse: "22:00", doors2_early: "23:00", kitchen: "22:00",
                doors2_late: "00:30", main1: "23:00", main2: "23:00", main3: "23:30", main4: "00:15",
                runner1: "21:00", runner2: "21:00", runner3: "21:00", runner4: "22:00", runner5: "00:00", runner6: "00:00",
                gard1: "22:45", gard2: "23:00", gard3: "00:15", technik: "21:00",
                security: [{ time: "22:45", pax: "1 PAX" }, { time: "23:00", pax: "1 PAX" }, { time: "23:30", pax: "1 PAX" }, { time: "00:30", pax: "3 PAX" }, { time: "01:00", pax: "1 PAX (Abruf)" }]
            },
            CONCERT: {
                doors1: "19:00", terrasse: "18:30", doors2_early: "19:00", kitchen: "18:30",
                doors2_late: "19:00", main1: "19:00", main2: "19:00", main3: "19:00", main4: "19:00",
                runner1: "17:00", runner2: "17:00", runner3: "17:00", runner4: "18:00", runner5: "20:00", runner6: "20:00",
                gard1: "18:45", gard2: "19:00", gard3: "20:15", technik: "16:00",
                security: [{ time: "18:45", pax: "1 PAX" }, { time: "19:00", pax: "2 PAX" }, { time: "19:30", pax: "1 PAX" }, { time: "19:45", pax: "1 PAX" }, { time: "20:30", pax: "1 PAX (Abruf)" }]
            }
        };
        
        const EIGENVERANSTALTUNGEN = ['turbo', 'selected', 'halloween', 'nye', 'silvester', 'birthday', 'x-mas', 'sommerfest'];
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MSAL AUTH
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function initMsal() {
            // Check if MSAL library loaded
            if (typeof msal === 'undefined') {
                console.error('MSAL library not loaded!');
                document.getElementById('auth-status-text').textContent = '‚ùå Auth Library fehlt';
                return;
            }
            
            try {
                console.log('Initializing MSAL...');
                msalInstance = new msal.PublicClientApplication(msalConfig);
                await msalInstance.initialize();
                console.log('MSAL initialized successfully');
                
                // Check for existing session
                const accounts = msalInstance.getAllAccounts();
                if (accounts.length > 0) {
                    try {
                        const silentResponse = await msalInstance.acquireTokenSilent({ ...loginRequest, account: accounts[0] });
                        accessToken = silentResponse.accessToken;
                        console.log('Silent token scopes:', silentResponse.scopes);
                        updateAuthUI(accounts[0]);
                        loadAllData();
                    } catch (e) { 
                        console.log("Silent token failed, need re-login:", e.message);
                        updateAuthUI(null);
                    }
                }
            } catch (error) { console.error("MSAL init error:", error); }
        }
        
        async function handleAuth() {
            if (accessToken) {
                // Logout
                try {
                    await msalInstance.logoutPopup();
                } catch(e) { console.log('Logout error:', e); }
                accessToken = null;
                updateAuthUI(null);
                resetAllUI();
            } else {
                try {
                    // Use popup (works in iframes)
                    const response = await msalInstance.loginPopup({ ...loginRequest, prompt: 'consent' });
                    accessToken = response.accessToken;
                    console.log('=== LOGIN SUCCESS (POPUP) ===');
                    console.log('Scopes granted:', response.scopes);
                    console.log('Account:', response.account?.username);
                    updateAuthUI(response.account);
                    loadAllData();
                    showToast("‚úÖ Verbunden!");
                } catch (error) { 
                    console.error("Login error:", error); 
                    showToast("‚ùå Login fehlgeschlagen", true); 
                }
            }
        }
        
        async function forceResetAuth() {
            // Clear everything and start fresh
            showToast("üîÑ Cache wird gel√∂scht...");
            
            // Clear MSAL cache
            if (msalInstance) {
                const accounts = msalInstance.getAllAccounts();
                for (const account of accounts) {
                    try {
                        await msalInstance.clearCache();
                    } catch(e) { console.log('Cache clear error:', e); }
                }
            }
            
            // Clear localStorage
            localStorage.clear();
            sessionStorage.clear();
            
            // Reset state
            accessToken = null;
            updateAuthUI(null);
            resetAllUI();
            
            showToast("‚úÖ Cache gel√∂scht! Seite wird neu geladen...");
            
            // Reload page to ensure clean state
            setTimeout(() => location.reload(), 1000);
        }
        
        function updateAuthUI(account) {
            const dot = document.getElementById('auth-dot');
            const statusText = document.getElementById('auth-status-text');
            const userText = document.getElementById('auth-user');
            const authBtn = document.getElementById('auth-btn');
            if (account) {
                dot.classList.add('connected');
                statusText.textContent = 'Verbunden';
                userText.textContent = account.username || '';
                authBtn.innerHTML = '<span>üö™</span> Abmelden';
                authBtn.classList.add('logout');
            } else {
                dot.classList.remove('connected');
                statusText.textContent = 'Nicht verbunden';
                userText.textContent = '';
                authBtn.innerHTML = '<span>üîê</span> Sign in';
                authBtn.classList.remove('logout');
            }
        }
        
        function loadAllData() { 
            console.log('loadAllData: Starting with token:', accessToken ? 'YES' : 'NO');
            if (!accessToken) {
                console.log('loadAllData: No token, skipping');
                return;
            }
            console.log('loadAllData: Calling loadAllTasks...');
            loadAllTasks(); 
        }
        
        function resetAllUI() {
            ['office', 'bar', 'runner', 'technik', 'sputnik'].forEach(d => {
                document.getElementById(`${d}-task-count`).textContent = '‚Äî';
                document.getElementById(`${d}-tasks-list`).innerHTML = '<div class="tasks-login-prompt"><p>Sign in</p><button onclick="handleAuth()">üîê</button></div>';
            });
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TASKS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function loadAllTasks() {
            if (!accessToken) return;
            for (const d of ['office', 'bar', 'runner', 'technik', 'sputnik']) await loadTasks(d);
        }
        
        async function loadTasks(dept) {
            if (!accessToken) return;
            const listId = TODO_LISTS[dept];
            const countEl = document.getElementById(`${dept}-task-count`);
            const listEl = document.getElementById(`${dept}-tasks-list`);
            countEl.textContent = '...';
            try {
                const r = await fetch(`https://graph.microsoft.com/v1.0/me/todo/lists/${listId}/tasks?$filter=status ne 'completed'&$orderby=importance desc&$top=10`, {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const data = await r.json();
                const tasks = data.value || [];
                countEl.textContent = tasks.length || '‚úì';
                listEl.innerHTML = tasks.length ? tasks.map(t => {
                    let dueClass = '', dueText = '';
                    if (t.dueDateTime) {
                        const due = new Date(t.dueDateTime.dateTime + 'Z');
                        const today = new Date(); today.setHours(0,0,0,0);
                        if (due < today) { dueClass = 'overdue'; dueText = '√úberf√§llig'; }
                        else if (due.toDateString() === today.toDateString()) { dueClass = 'today'; dueText = 'Heute'; }
                        else dueText = due.toLocaleDateString('de-DE');
                    }
                    return `<div class="task-item" data-id="${t.id}" data-dept="${dept}">
                        <div class="task-checkbox" onclick="completeTask('${t.id}','${dept}')"></div>
                        <div class="task-info"><div class="task-title">${esc(t.title)}</div>${dueText ? `<div class="task-due ${dueClass}">${dueText}</div>` : ''}</div>
                        ${t.importance === 'high' ? '<div class="task-importance high"></div>' : ''}
                    </div>`;
                }).join('') : '<div class="tasks-empty">üéâ Alles erledigt!</div>';
            } catch (e) { countEl.textContent = '!'; listEl.innerHTML = '<div class="tasks-empty">‚ö†Ô∏è</div>'; }
        }
        
        async function completeTask(taskId, dept) {
            const el = document.querySelector(`[data-id="${taskId}"]`);
            el.querySelector('.task-checkbox').classList.add('checked');
            try {
                await fetch(`https://graph.microsoft.com/v1.0/me/todo/lists/${TODO_LISTS[dept]}/tasks/${taskId}`, {
                    method: 'PATCH',
                    headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: 'completed' })
                });
                showToast("‚úÖ Erledigt!");
                setTimeout(() => loadTasks(dept), 500);
            } catch (e) { el.querySelector('.task-checkbox').classList.remove('checked'); }
        }
        
        function refreshTasks(d) { const b = document.querySelector(`#${d}-tasks .refresh-btn`); b.classList.add('spinning'); loadTasks(d).then(() => b.classList.remove('spinning')); }
        function openToDoList(d) { window.open(`https://to-do.live.com/tasks/${TODO_LISTS[d]}`, '_blank'); }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PRESALE CALCULATOR
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function calculatePreSale() {
            const fohTickets = parseInt(document.getElementById('ps-foh-tickets').value) || 350;
            const doorPrice = parseInt(document.getElementById('ps-door-price').value) || 22;
            
            // Sum all VVK phases
            const rows = document.querySelectorAll('#ps-phases-body tr');
            let totalVVK = 0, totalVVKRev = 0;
            rows.forEach(row => {
                const tickets = parseInt(row.querySelector('.ps-tickets').value) || 0;
                const price = parseInt(row.querySelector('.ps-price').value) || 0;
                const rev = tickets * price;
                row.querySelector('.phase-revenue').textContent = '‚Ç¨' + rev.toLocaleString();
                totalVVK += tickets;
                totalVVKRev += rev;
            });
            
            const fohRev = fohTickets * doorPrice;
            const avgVvk = totalVVK > 0 ? (totalVVKRev / totalVVK).toFixed(2) : 0;
            const totalTickets = totalVVK + fohTickets;
            const totalRev = totalVVKRev + fohRev;
            
            document.getElementById('ps-result-vvk').textContent = totalVVK;
            document.getElementById('ps-result-vvk-rev').textContent = '‚Ç¨' + totalVVKRev.toLocaleString();
            document.getElementById('ps-result-avg').textContent = '‚Ç¨' + avgVvk;
            document.getElementById('ps-result-foh').textContent = fohTickets;
            document.getElementById('ps-result-foh-rev').textContent = '‚Ç¨' + fohRev.toLocaleString();
            document.getElementById('ps-result-total').textContent = '‚Ç¨' + totalRev.toLocaleString();
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // COST CALCULATOR
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function calculateCosts() {
            const ticketRev = parseInt(document.getElementById('cc-ticket-rev').value) || 0;
            const barRev = parseInt(document.getElementById('cc-bar-rev').value) || 0;
            const totalRev = ticketRev + barRev;
            
            // Staff costs (rough estimates)
            const barStaff = (parseInt(document.getElementById('cc-bar-staff').value) || 0) * 150;
            const runnerStaff = (parseInt(document.getElementById('cc-runner-staff').value) || 0) * 120;
            const gardStaff = (parseInt(document.getElementById('cc-garderobe-staff').value) || 0) * 100;
            const secStaff = (parseInt(document.getElementById('cc-security-staff').value) || 0) * 180;
            const techStaff = (parseInt(document.getElementById('cc-tech-staff').value) || 0) * 200;
            const cvdStaff = (parseInt(document.getElementById('cc-cvd-staff').value) || 0) * 150;
            const staffCosts = barStaff + runnerStaff + gardStaff + secStaff + techStaff + cvdStaff;
            
            // Fixed costs
            const artist = parseInt(document.getElementById('cc-artist').value) || 0;
            const gema = parseInt(document.getElementById('cc-gema').value) || 0;
            const marketing = parseInt(document.getElementById('cc-marketing').value) || 0;
            const other = parseInt(document.getElementById('cc-other').value) || 0;
            const fixedCosts = artist + gema + marketing + other;
            
            const totalCosts = staffCosts + fixedCosts;
            const profit = totalRev - totalCosts;
            const margin = totalRev > 0 ? ((profit / totalRev) * 100).toFixed(1) : 0;
            
            document.getElementById('cc-result-revenue').textContent = `‚Ç¨${totalRev.toLocaleString()}`;
            document.getElementById('cc-result-staff').textContent = `‚Ç¨${staffCosts.toLocaleString()}`;
            document.getElementById('cc-result-fixed').textContent = `‚Ç¨${fixedCosts.toLocaleString()}`;
            document.getElementById('cc-result-costs').textContent = `‚Ç¨${totalCosts.toLocaleString()}`;
            document.getElementById('cc-result-profit').textContent = `‚Ç¨${profit.toLocaleString()}`;
            document.getElementById('cc-result-profit').className = `value ${profit >= 0 ? '' : 'red'}`;
            document.getElementById('cc-result-margin').textContent = `${margin}%`;
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // EVENT PROJECTOR
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function updateProjectorData() {
            const serie = document.getElementById('ep-serie').value;
            const kw = document.getElementById('ep-kw').value;
            const s = SERIE_STATS[serie];
            const k = KW_STATS[kw] || { barPP: 16.5 };
            
            document.getElementById('ep-avg-vvk').textContent = s.avgVVK;
            document.getElementById('ep-avg-foh').textContent = s.avgFOH;
            document.getElementById('ep-avg-total').textContent = s.avgTotal;
            document.getElementById('ep-events').textContent = s.events;
            document.getElementById('ep-bar-pp').textContent = `‚Ç¨${k.barPP}`;
            document.getElementById('ep-bar-rev').textContent = `‚Ç¨${Math.round(s.avgTotal * k.barPP).toLocaleString()}`;
            document.getElementById('ep-bar-guests').textContent = s.avgTotal;
            
            updateProjectorProjection();
        }
        
        function updateProjectorProjection() {
            const serie = document.getElementById('ep-serie').value;
            const kw = document.getElementById('ep-kw').value;
            const currentVVK = parseInt(document.getElementById('ep-current-vvk').value) || 0;
            const days = parseInt(document.getElementById('ep-days').value) || 7;
            
            const s = SERIE_STATS[serie];
            const k = KW_STATS[kw] || { barPP: 16.5 };
            const fohRatio = s.avgFOH / s.avgVVK;
            
            let pct = 0.5;
            for (const d of [14, 10, 7, 5, 3, 2, 1, 0]) { if (days >= d) { pct = VVK_BENCHMARKS[d]; break; } }
            
            const projVVK = currentVVK > 0 ? Math.round(currentVVK / pct) : s.avgVVK;
            const projFOH = Math.round(projVVK * fohRatio);
            const projBar = (projVVK + projFOH) * k.barPP;
            const projTotal = projBar + (projVVK * 18) + (projFOH * 22);
            
            document.getElementById('ep-proj-vvk').textContent = `~${projVVK}`;
            document.getElementById('ep-proj-foh').textContent = `~${projFOH}`;
            document.getElementById('ep-proj-bar').textContent = `~‚Ç¨${(projBar/1000).toFixed(1)}k`;
            document.getElementById('ep-proj-total').textContent = `~‚Ç¨${(projTotal/1000).toFixed(0)}k`;
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FACTSHEET GENERATOR
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function isEigenveranstaltung(name) { return EIGENVERANSTALTUNGEN.some(e => name.toLowerCase().includes(e)); }
        function getKassa(name) { return isEigenveranstaltung(name) ? "Matth√§us / Schadi / Isa" : "FREMD"; }
        
        function updateFactsheetPreview() {
            const eventName = document.getElementById('fs-event-name').value || 'EVENT';
            const datum = document.getElementById('fs-datum').value || 'Datum';
            const eventType = document.getElementById('fs-template').value;
            
            // Determine template based on event type and main floor time
            let template;
            if (eventType === 'CONCERT') {
                template = 'CONCERT';
                document.getElementById('main-floor-row').style.display = 'none';
            } else {
                document.getElementById('main-floor-row').style.display = 'block';
                const mainFloorTime = document.querySelector('input[name="main-floor-time"]:checked')?.value || '00:00';
                template = mainFloorTime === '00:30' ? 'MAIN_30' : 'MAIN_00';
            }
            
            const t = TEMPLATES[template];
            
            const kassa = getKassa(eventName);
            const cvd = document.getElementById('fs-cvd').value || '';
            const technik = document.getElementById('fs-technik').value || '';
            const terrasse = document.getElementById('fs-terrasse').value || '';
            const kitchen = document.getElementById('fs-kitchen').value || '';
            const main1 = document.getElementById('fs-main1').value || '';
            const main2 = document.getElementById('fs-main2').value || '';
            const main3 = document.getElementById('fs-main3').value || '';
            const main4 = document.getElementById('fs-main4').value || '';
            const runner1 = document.getElementById('fs-runner1').value || '';
            const runner2 = document.getElementById('fs-runner2').value || '';
            const runner3 = document.getElementById('fs-runner3').value || '';
            const runner4 = document.getElementById('fs-runner4').value || '';
            const runner5 = document.getElementById('fs-runner5').value || '';
            const runner6 = document.getElementById('fs-runner6').value || '';
            const gard1 = document.getElementById('fs-gard1').value || '';
            const gard2 = document.getElementById('fs-gard2').value || '';
            const gard3 = document.getElementById('fs-gard3').value || '';
            
            const secRows = t.security.map((s, i) => `<tr><td>${i === 0 ? 'SECURITY:' : ''}</td><td>${s.time}</td><td>${s.pax}</td></tr>`).join('');
            
            document.getElementById('fs-preview').innerHTML = `
                <h2>EVENT: <span class="event-name">${eventName.toUpperCase()}</span></h2>
                <p>Datum: ${datum}</p>
                <p><strong>AUFSTELLUNG:</strong></p>
                <table>
                    <tr><td><strong>PAX:</strong></td><td></td><td></td></tr>
                    <tr><td><strong>CVD:</strong></td><td>20:30</td><td>${cvd}</td></tr>
                    <tr><td><strong>KASSA:</strong></td><td>22:30</td><td>${kassa}</td></tr>
                    <tr><td colspan="3"></td></tr>
                    <tr><td><strong>DOORS 1:</strong></td><td>${t.doors1}</td><td></td></tr>
                    <tr><td>TERRASSE 1</td><td>${t.terrasse}</td><td>${terrasse}</td></tr>
                    <tr><td><strong>DOORS 2:</strong></td><td>${t.doors2_early}</td><td></td></tr>
                    <tr><td>KITCHEN:</td><td>${t.kitchen}</td><td>${kitchen}</td></tr>
                    <tr><td colspan="3"></td></tr>
                    <tr><td><strong>DOORS 2:</strong></td><td>${t.doors2_late}</td><td></td></tr>
                    <tr><td>MAIN 1:</td><td>${t.main1}</td><td>${main1}</td></tr>
                    <tr><td>MAIN 2:</td><td>${t.main2}</td><td>${main2}</td></tr>
                    <tr><td>MAIN 3:</td><td>${t.main3}</td><td>${main3}</td></tr>
                    <tr><td>MAIN 4:</td><td>${t.main4}</td><td>${main4}</td></tr>
                    <tr><td colspan="3"></td></tr>
                    <tr><td>RUNNER 1:</td><td>${t.runner1}</td><td>${runner1}</td></tr>
                    <tr><td>RUNNER 2:</td><td>${t.runner2}</td><td>${runner2}</td></tr>
                    <tr><td>RUNNER 3:</td><td>${t.runner3}</td><td>${runner3}</td></tr>
                    <tr><td>RUNNER 4:</td><td>${t.runner4}</td><td>${runner4}</td></tr>
                    <tr><td>RUNNER 5:</td><td>${t.runner5}</td><td>${runner5}</td></tr>
                    ${runner6 ? `<tr><td>RUNNER 6:</td><td>${t.runner6 || t.runner5}</td><td>${runner6}</td></tr>` : ''}
                    <tr><td colspan="3"></td></tr>
                    <tr><td>GARDEROBE 1</td><td>${t.gard1}</td><td>${gard1}</td></tr>
                    <tr><td>GARDEROBE 2</td><td>${t.gard2}</td><td>${gard2}</td></tr>
                    <tr><td>GARDEROBE 3</td><td>${t.gard3}</td><td>${gard3}</td></tr>
                    <tr><td colspan="3"></td></tr>
                    <tr><td><strong>TECHNIK:</strong></td><td>${t.technik}</td><td>${technik}</td></tr>
                    <tr><td colspan="3"></td></tr>
                    ${secRows}
                </table>
            `;
        }
        
        // Event data storage
        const EVENT_STAFF_DATA = {
            'turbo': { 
                name: 'TURBO', 
                datum: 'Samstag, 27.12.2025', 
                technik: 'Simon', 
                cvd: 'Alain',
                eventType: 'CLUB',
                mainFloorTime: '00:30',
                terrasse: '-',
                kitchen: 'Dhanna',
                main1: 'Ada',
                main2: 'Lino',
                main3: 'Milos',
                main4: 'Dora',
                runner1: 'Jakob',
                runner2: 'Kaan',
                runner3: 'TBA',
                runner4: 'Peter',
                runner5: 'Aziz',
                runner6: '',
                gard1: 'Sofia',
                gard2: 'Fayez',
                gard3: 'Nico'
            },
            'nye': { 
                name: 'NYE SILVESTER', 
                datum: 'Dienstag, 31.12.2025', 
                technik: 'Jan', 
                cvd: 'Alain / Niat',
                eventType: 'CLUB',
                mainFloorTime: '00:00',
                terrasse: '-',
                kitchen: 'TBA',
                main1: 'TBA',
                main2: 'TBA',
                main3: 'TBA',
                main4: 'TBA',
                runner1: 'TBA',
                runner2: 'TBA',
                runner3: 'TBA',
                runner4: 'TBA',
                runner5: 'TBA',
                runner6: '',
                gard1: 'TBA',
                gard2: 'TBA',
                gard3: 'TBA'
            }
        };
        
        // Load event data when dropdown changes
        function loadEventData() {
            const eventId = document.getElementById('fs-event-select').value;
            if (!eventId) return;
            
            const e = EVENT_STAFF_DATA[eventId];
            if (e) {
                fillFactsheetForm(e);
            }
        }
        
        // Fill all factsheet form fields
        function fillFactsheetForm(e) {
            document.getElementById('fs-event-name').value = e.name;
            document.getElementById('fs-datum').value = e.datum;
            document.getElementById('fs-template').value = e.eventType || 'CLUB';
            
            // Set main floor time radio
            const mainFloorRadio = document.querySelector(`input[name="main-floor-time"][value="${e.mainFloorTime || '00:00'}"]`);
            if (mainFloorRadio) mainFloorRadio.checked = true;
            
            document.getElementById('fs-technik').value = e.technik || '';
            document.getElementById('fs-cvd').value = e.cvd || '';
            document.getElementById('fs-terrasse').value = e.terrasse || '';
            document.getElementById('fs-kitchen').value = e.kitchen || '';
            document.getElementById('fs-main1').value = e.main1 || '';
            document.getElementById('fs-main2').value = e.main2 || '';
            document.getElementById('fs-main3').value = e.main3 || '';
            document.getElementById('fs-main4').value = e.main4 || '';
            document.getElementById('fs-runner1').value = e.runner1 || '';
            document.getElementById('fs-runner2').value = e.runner2 || '';
            document.getElementById('fs-runner3').value = e.runner3 || '';
            document.getElementById('fs-runner4').value = e.runner4 || '';
            document.getElementById('fs-runner5').value = e.runner5 || '';
            document.getElementById('fs-runner6').value = e.runner6 || '';
            document.getElementById('fs-gard1').value = e.gard1 || '';
            document.getElementById('fs-gard2').value = e.gard2 || '';
            document.getElementById('fs-gard3').value = e.gard3 || '';
            
            updateFactsheetPreview();
        }
        
        // Quick factsheet for specific event from dashboard
        function autoFactsheetForEvent(eventId) {
            const e = EVENT_STAFF_DATA[eventId];
            if (e) {
                // Set dropdown
                document.getElementById('fs-event-select').value = eventId;
                fillFactsheetForm(e);
                openModal('factsheet-modal');
                showToast(`üìÑ ${e.name} Factsheet geladen!`);
            }
        }
        
        function copyFactsheet() {
            const preview = document.getElementById('fs-preview');
            const range = document.createRange();
            range.selectNode(preview);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            showToast("üìã Factsheet kopiert!");
        }
        
        function printFactsheet() {
            const preview = document.getElementById('fs-preview').innerHTML;
            const w = window.open('', '_blank');
            w.document.write(`<html><head><title>Factsheet</title><style>body{font-family:Arial;padding:20px;}table{width:100%;border-collapse:collapse;}th,td{border:1px solid #333;padding:8px;text-align:left;}.event-name{color:red;}</style></head><body>${preview}</body></html>`);
            w.document.close();
            w.print();
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // VVK TRACKER (Events Dashboard)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function getDaysUntil(id) {
            const d = EVENT_CONFIG[id].date;
            const today = new Date(); today.setHours(0,0,0,0);
            return Math.max(0, Math.ceil((d - today) / 86400000));
        }
        
        function updateProjection(id) {
            const cfg = EVENT_CONFIG[id];
            const s = SERIE_STATS[cfg.serie];
            const k = KW_STATS[cfg.kw] || { barPP: 16.5 };
            const days = getDaysUntil(id);
            
            const currentVVK = parseInt(document.getElementById(`${id}-vvk-input`).value) || 0;
            const vvkZiel = parseInt(document.getElementById(`${id}-ziel-input`).value) || 450;
            const maxVVKInput = parseInt(document.getElementById(`${id}-max-input`).value) || 600;
            const vvkPrice = parseFloat(document.getElementById(`${id}-vvk-price`).value) || 18;
            const fohPrice = parseFloat(document.getElementById(`${id}-foh-price`).value) || 22;
            
            // Apply historical capacity caps
            const maxVVK = Math.min(maxVVKInput, CAPACITY_CAPS.MAX_VVK);
            
            let pct = 0.5;
            for (const d of [14,10,7,5,3,2,1,0]) { if (days >= d) { pct = VVK_BENCHMARKS[d]; break; } }
            
            const fohRatio = s.avgFOH / s.avgVVK;
            let projVVK = currentVVK > 0 ? Math.min(Math.round(currentVVK / pct), maxVVK) : Math.min(vvkZiel, maxVVK);
            let projFOH = Math.round(projVVK * fohRatio);
            
            // Apply FOH and Total caps
            projFOH = Math.min(projFOH, CAPACITY_CAPS.MAX_FOH);
            const projTotalGuests = projVVK + projFOH;
            if (projTotalGuests > CAPACITY_CAPS.MAX_TOTAL) {
                const scale = CAPACITY_CAPS.MAX_TOTAL / projTotalGuests;
                projVVK = Math.round(projVVK * scale);
                projFOH = Math.round(projFOH * scale);
            }
            
            const projBar = (projVVK + projFOH) * k.barPP;
            const projTotal = projBar + (projVVK * vvkPrice) + (projFOH * fohPrice);
            
            document.getElementById(`${id}-days`).textContent = `${days} Tage`;
            document.getElementById(`${id}-vvk-proj`).textContent = `~${projVVK}`;
            document.getElementById(`${id}-foh-proj`).textContent = `~${projFOH}`;
            document.getElementById(`${id}-bar-proj`).textContent = `~‚Ç¨${(projBar/1000).toFixed(1)}k`;
            document.getElementById(`${id}-total-proj`).textContent = `~‚Ç¨${(projTotal/1000).toFixed(1)}k`;
            document.getElementById(`${id}-tickets-quick`).textContent = `üé´ ~${projVVK + projFOH}`;
            document.getElementById(`${id}-bar-quick`).textContent = `üç∫ ~‚Ç¨${(projBar/1000).toFixed(1)}k`;
            
            const progress = Math.min(100, (currentVVK / vvkZiel) * 100);
            document.getElementById(`${id}-progress`).style.width = `${progress}%`;
            
            const expected = Math.round(vvkZiel * pct);
            document.getElementById(`${id}-benchmark`).textContent = `Ziel: ${vvkZiel} | ${Math.round(pct*100)}% bei ${days}d ‚Üí Soll ~${expected}`;
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function openModal(id) { document.getElementById(id).classList.add('show'); }
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        
        function toggleSection(label) { label.classList.toggle('open'); label.nextElementSibling.classList.toggle('open'); }
        
        function toggleTasksSection(dept) {
            const header = document.querySelector(`#${dept}-tasks .tasks-header`);
            const list = document.getElementById(`${dept}-tasks-list`);
            header.classList.toggle('open');
            list.classList.toggle('open');
        }
        
        function toggleDropdown(id) {
            document.querySelectorAll('.dropdown-content').forEach(d => { if (d.id !== id) d.classList.remove('show'); });
            document.getElementById(id).classList.toggle('show');
        }
        document.addEventListener('click', e => { if (!e.target.closest('.dropdown-container')) document.querySelectorAll('.dropdown-content').forEach(d => d.classList.remove('show')); });
        function toggleEventCard(id) { document.getElementById(id).classList.toggle('open'); }
        
        function showToast(msg, isError) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
        
        // Quick Notes Functions
        let notesTimeout = null;
        
        function saveQuickNotes() {
            clearTimeout(notesTimeout);
            notesTimeout = setTimeout(() => {
                const text = document.getElementById('quick-notes-text').value;
                localStorage.setItem('workhub-quick-notes', text);
                const indicator = document.getElementById('notes-saved');
                indicator.classList.add('show');
                setTimeout(() => indicator.classList.remove('show'), 2000);
            }, 500);
        }
        
        function loadQuickNotes() {
            const saved = localStorage.getItem('workhub-quick-notes');
            if (saved) {
                document.getElementById('quick-notes-text').value = saved;
            }
        }
        
        // Deep Analysis Function
        function openDeepAnalysis() {
            // Opens the Grelle Forelle Analysis Project in Claude
            window.open('https://claude.ai/project/0199e959-4ffb-70e3-8b70-5a7c8594bce7', '_blank');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // EMAIL COMPOSER
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function sendEmail() {
            const to = document.getElementById('email-to').value;
            const subject = document.getElementById('email-subject').value;
            const body = document.getElementById('email-body').value;
            const status = document.getElementById('email-status');
            
            if (!to || !subject || !body) {
                status.textContent = '‚ö†Ô∏è Bitte alle Felder ausf√ºllen';
                status.style.color = '#f59e0b';
                return;
            }
            
            if (!accessToken) {
                status.textContent = '‚ö†Ô∏è Bitte zuerst mit Microsoft anmelden';
                status.style.color = '#ef4444';
                return;
            }
            
            status.textContent = 'üì§ Sende...';
            status.style.color = '#888';
            
            try {
                const response = await fetch('https://graph.microsoft.com/v1.0/me/sendMail', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: {
                            subject: subject,
                            body: { contentType: 'Text', content: body },
                            toRecipients: [{ emailAddress: { address: to } }]
                        }
                    })
                });
                
                if (response.ok || response.status === 202) {
                    status.textContent = '‚úÖ E-Mail gesendet!';
                    status.style.color = '#22c55e';
                    showToast('‚úÖ E-Mail gesendet!');
                    // Clear form after 2 seconds
                    setTimeout(() => {
                        document.getElementById('email-to').value = '';
                        document.getElementById('email-subject').value = '';
                        document.getElementById('email-body').value = '';
                        status.textContent = '';
                        closeModal('email-modal');
                    }, 2000);
                } else {
                    const err = await response.json();
                    status.textContent = '‚ùå Fehler: ' + (err.error?.message || 'Unbekannt');
                    status.style.color = '#ef4444';
                }
            } catch (e) {
                status.textContent = '‚ùå Fehler: ' + e.message;
                status.style.color = '#ef4444';
            }
        }
        
        function esc(str) { const d = document.createElement('div'); d.textContent = str; return d.innerHTML; }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INIT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Work Hub v13.2 - Capacity Caps + Quick Notes');
            loadQuickNotes();
            initMsal();
            updateProjection('turbo');
            updateProjection('nye');
            calculatePreSale();
            calculateCosts();
            updateProjectorData();
            updateFactsheetPreview();
        });
    </script>
</body>
</html>
