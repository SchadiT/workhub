<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turbo-Projects Work Hub</title>
    <!-- MSAL.js for Microsoft Authentication -->
    <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 28px; margin-bottom: 5px; }
        .header p { color: #888; font-size: 14px; }
        
        /* Auth Status Bar */
        .auth-bar {
            display: flex; justify-content: center; align-items: center; gap: 10px;
            margin-bottom: 15px; padding: 10px; background: #252542; border-radius: 10px;
            flex-wrap: wrap;
        }
        .auth-status {
            display: flex; align-items: center; gap: 8px; font-size: 13px;
        }
        .auth-status .dot {
            width: 8px; height: 8px; border-radius: 50%; background: #ef4444;
        }
        .auth-status .dot.connected { background: #22c55e; }
        .auth-btn {
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);
            border: none; border-radius: 8px; padding: 8px 16px;
            color: white; font-size: 13px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; gap: 6px;
        }
        .auth-btn:hover { opacity: 0.9; }
        .auth-btn.logout { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }
        .auth-user { font-size: 12px; color: #888; }
        
        /* Quick Actions */
        .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
        .quick-actions-row2 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
        .quick-actions-row3 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        
        .quick-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; border-radius: 12px; padding: 15px 10px;
            color: white; text-decoration: none; text-align: center;
            font-weight: 600; font-size: 13px; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s; display: block;
        }
        .quick-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        
        .dropdown-container { position: relative; }
        .dropdown-btn { background: linear-gradient(135deg, #E4405F 0%, #c13584 100%); width: 100%; }
        .dropdown-btn.sales { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .dropdown-content {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #252542; border-radius: 8px; margin-top: 5px; z-index: 100;
            overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .dropdown-content.show { display: block; }
        .dropdown-item {
            display: block; padding: 12px 15px; color: white; text-decoration: none;
            font-size: 13px; border-bottom: 1px solid #3d3d54; transition: background 0.2s;
        }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background: #3d3d54; }
        .dropdown-item .icon { margin-right: 8px; }
        
        .btn-graphics { background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%); }
        .btn-whatsapp { background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); }
        .btn-post-creator { background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%); }
        .btn-calculator { background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%); }
        .btn-presale { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .btn-email { background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%); }
        
        /* Outlook Section */
        .outlook-section {
            background: linear-gradient(135deg, #252542 0%, #1a1a2e 100%);
            border-radius: 15px; margin-bottom: 20px; overflow: hidden;
            border: 1px solid #0078d4;
        }
        .outlook-header {
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
        }
        .outlook-header h2 { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .outlook-tabs {
            display: flex; gap: 5px;
        }
        .outlook-tab {
            background: rgba(255,255,255,0.2); border: none; padding: 8px 16px;
            border-radius: 8px; color: white; font-size: 13px; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
        }
        .outlook-tab:hover { background: rgba(255,255,255,0.3); }
        .outlook-tab.active { background: white; color: #0078d4; }
        .outlook-content { padding: 15px; }
        .outlook-panel { display: none; }
        .outlook-panel.active { display: block; }
        
        /* Email List */
        .email-list { max-height: 400px; overflow-y: auto; }
        .email-item {
            display: flex; gap: 12px; padding: 12px; border-radius: 8px;
            margin-bottom: 8px; background: #1a1a2e; cursor: pointer;
            transition: all 0.2s; border: 1px solid transparent;
        }
        .email-item:hover { border-color: #0078d4; background: #252542; }
        .email-item.unread { border-left: 3px solid #0078d4; }
        .email-item.unread .email-subject { font-weight: 700; }
        .email-avatar {
            width: 40px; height: 40px; border-radius: 50%; background: #3d3d54;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 14px; flex-shrink: 0;
        }
        .email-content { flex: 1; min-width: 0; }
        .email-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .email-from { font-size: 14px; font-weight: 600; color: #fff; }
        .email-time { font-size: 11px; color: #888; }
        .email-subject { font-size: 13px; color: #ccc; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .email-preview { font-size: 12px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        /* Calendar List */
        .calendar-events { max-height: 400px; overflow-y: auto; }
        .calendar-event-item {
            display: flex; gap: 12px; padding: 12px; border-radius: 8px;
            margin-bottom: 8px; background: #1a1a2e; border-left: 3px solid #22c55e;
        }
        .calendar-event-item.today { border-left-color: #ef4444; }
        .calendar-event-item.tomorrow { border-left-color: #f59e0b; }
        .event-time-block {
            min-width: 60px; text-align: center;
        }
        .event-date-label { font-size: 11px; color: #888; margin-bottom: 2px; }
        .event-time-label { font-size: 14px; font-weight: 700; color: #fff; }
        .event-details { flex: 1; }
        .event-title { font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 4px; }
        .event-location { font-size: 12px; color: #888; display: flex; align-items: center; gap: 5px; }
        
        /* Compose Modal */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: #252542; border-radius: 15px; width: 90%; max-width: 600px;
            max-height: 90vh; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .modal-header {
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
        }
        .modal-header h3 { font-size: 16px; font-weight: 700; }
        .modal-close {
            background: none; border: none; color: white; font-size: 24px;
            cursor: pointer; line-height: 1;
        }
        .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 13px; color: #888; margin-bottom: 5px; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 10px 12px; border-radius: 8px;
            border: 1px solid #3d3d54; background: #1a1a2e; color: #fff;
            font-size: 14px; font-family: inherit;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: #0078d4;
        }
        .form-group textarea { min-height: 150px; resize: vertical; }
        .template-btns { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .template-btn {
            background: #3d3d54; border: none; padding: 8px 12px; border-radius: 6px;
            color: #fff; font-size: 12px; cursor: pointer; transition: all 0.2s;
        }
        .template-btn:hover { background: #0078d4; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #3d3d54; display: flex; justify-content: flex-end; gap: 10px; }
        .modal-btn {
            padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600;
            cursor: pointer; border: none; transition: all 0.2s;
        }
        .modal-btn.cancel { background: #3d3d54; color: #fff; }
        .modal-btn.send { background: #0078d4; color: #fff; }
        .modal-btn:hover { opacity: 0.9; }
        
        /* Upcoming Events */
        .upcoming-events { margin-bottom: 20px; }
        .upcoming-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .upcoming-title { font-size: 18px; font-weight: 700; color: #fff; }
        .upcoming-week-label { font-size: 14px; font-weight: 600; color: #888; margin-bottom: 10px; padding-left: 5px; }
        .upcoming-week-label.current { color: #ef4444; }
        .upcoming-week-label.next { color: #eab308; }
        
        .event-card {
            background: linear-gradient(135deg, #252542 0%, #1a1a2e 100%);
            border-radius: 12px; margin-bottom: 12px; overflow: hidden; border: 1px solid #3d3d54;
        }
        .event-card-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; cursor: pointer; user-select: none;
        }
        .event-card-header:hover { background: rgba(255,255,255,0.03); }
        .event-main-info { display: flex; align-items: center; gap: 12px; }
        .event-date {
            background: #3d3d54; padding: 6px 10px; border-radius: 6px;
            font-weight: 700; font-size: 13px; min-width: 70px; text-align: center;
        }
        .event-date.today { background: #ef4444; }
        .event-date.tomorrow { background: #f97316; }
        .event-name { font-weight: 600; font-size: 16px; }
        .event-tech {
            background: #757575; color: white; padding: 3px 8px;
            border-radius: 4px; font-size: 11px; font-weight: 600;
        }
        .event-quick-stats { display: flex; align-items: center; gap: 15px; font-size: 13px; color: #888; }
        .event-toggle { color: #888; font-size: 12px; transition: transform 0.3s; }
        .event-card.open .event-toggle { transform: rotate(180deg); }
        .event-details { display: none; padding: 0 15px 15px 15px; border-top: 1px solid #3d3d54; }
        .event-card.open .event-details { display: block; }
        
        /* Auto Projection */
        .auto-projection {
            background: linear-gradient(135deg, #1e3a5f 0%, #1a1a2e 100%);
            border: 1px solid #3b82f6; border-radius: 10px; padding: 12px 15px; margin: 12px 0;
        }
        .projection-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
        .proj-box { background: #1a1a2e; padding: 10px; border-radius: 8px; text-align: center; }
        .proj-box-label { font-size: 10px; color: #888; margin-bottom: 3px; text-transform: uppercase; }
        .proj-box-value { font-size: 16px; font-weight: 700; color: #22c55e; }
        .proj-box-value.tickets { color: #3b82f6; }
        .proj-box-value.bar { color: #f59e0b; }
        .proj-box-value.total { color: #22c55e; }
        .projection-basis {
            font-size: 11px; color: #888; text-align: center;
            padding-top: 8px; border-top: 1px solid #3d3d54;
        }
        
        .cvd-badge {
            display: inline-flex; align-items: center; gap: 5px;
            background: #43A047; color: white; padding: 5px 10px;
            border-radius: 6px; font-size: 12px; font-weight: 600; margin: 10px 0;
        }
        
        /* VVK Tracker */
        .vvk-tracker {
            background: linear-gradient(135deg, #1e3a5f 0%, #1a1a2e 100%);
            border: 1px solid #f59e0b; border-radius: 10px; padding: 12px 15px; margin-bottom: 12px;
        }
        .vvk-input-row {
            display: flex; align-items: center; gap: 6px; margin-bottom: 10px; flex-wrap: wrap;
        }
        .vvk-input-row label { font-size: 12px; font-weight: 600; color: #f59e0b; }
        .vvk-input-row input {
            width: 60px; padding: 6px 8px; border-radius: 6px; border: 1px solid #3d3d54;
            background: #1a1a2e; color: #fff; font-size: 14px; font-weight: 700; text-align: center;
        }
        .vvk-input-row input:focus { outline: none; border-color: #f59e0b; }
        .vvk-days {
            background: #3d3d54; padding: 6px 12px; border-radius: 6px;
            font-size: 12px; font-weight: 600; color: #888;
        }
        .vvk-progress-bar { height: 8px; background: #3d3d54; border-radius: 4px; overflow: hidden; margin-bottom: 8px; }
        .vvk-progress {
            height: 100%; background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #22c55e 100%);
            border-radius: 4px; transition: width 0.3s ease;
        }
        .vvk-benchmark { font-size: 11px; color: #888; text-align: center; }
        .vvk-status {
            display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-left: 8px;
        }
        .vvk-status.ahead { background: #22c55e; color: white; }
        .vvk-status.on-track { background: #f59e0b; color: white; }
        .vvk-status.behind { background: #ef4444; color: white; }
        
        .event-actions { display: flex; gap: 8px; margin-top: 12px; }
        .event-action-btn {
            flex: 1; background: #3d3d54; border: none; border-radius: 8px;
            padding: 10px; color: white; font-size: 12px; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
        }
        .event-action-btn:hover { background: #4d4d64; }
        .event-action-btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        /* Toast notification */
        .toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #22c55e; color: white; padding: 12px 24px; border-radius: 8px;
            font-weight: 600; z-index: 1001; display: none;
        }
        .toast.show { display: block; animation: fadeInOut 3s ease; }
        .toast.error { background: #ef4444; }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        
        /* Departments */
        .departments { display: grid; gap: 15px; }
        .dept { border-radius: 15px; overflow: hidden; text-decoration: none; display: block; }
        .dept-header {
            padding: 15px 20px; color: white; font-weight: bold; font-size: 18px;
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
        }
        .dept-header-left { display: flex; align-items: center; gap: 10px; }
        .task-count {
            background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 12px;
            font-size: 12px; font-weight: 600;
        }
        .task-count.loading { opacity: 0.5; }
        .office .dept-header { background: #1E88E5; }
        .office .dept-content { background: #E3F2FD; }
        .bar .dept-header { background: #F4511E; }
        .bar .dept-content { background: #FBE9E7; }
        .runner .dept-header { background: #43A047; }
        .runner .dept-content { background: #E8F5E9; }
        .technik .dept-header { background: #757575; }
        .technik .dept-content { background: #F5F5F5; }
        .sputnik .dept-header { background: #8E24AA; }
        .sputnik .dept-content { background: #F3E5F5; }
        .dept-content { padding: 15px; }
        
        .collapsible-section { margin-bottom: 10px; }
        .collapsible-section:last-child { margin-bottom: 0; }
        .section-label {
            color: white; padding: 12px 15px; font-size: 14px; font-weight: bold;
            border-radius: 8px; cursor: pointer; display: flex;
            justify-content: space-between; align-items: center; user-select: none;
        }
        .section-label:hover { opacity: 0.9; }
        .section-label .toggle-icon { font-size: 12px; transition: transform 0.3s; }
        .section-label.open .toggle-icon { transform: rotate(180deg); }
        .section-label.open { border-radius: 8px 8px 0 0; }
        .office .section-label { background: #1E88E5; }
        .bar .section-label { background: #F4511E; }
        .runner .section-label { background: #43A047; }
        .sputnik .section-label { background: #8E24AA; }
        .technik .section-label { background: #757575; }
        .section-content { display: none; background: white; border-radius: 0 0 8px 8px; overflow: hidden; }
        .section-content.open { display: block; }
        .section-content iframe { width: 100%; height: 300px; border: none; }
        
        /* Tasks Inline */
        .tasks-inline { background: white; border-radius: 8px; margin-top: 10px; overflow: hidden; }
        .tasks-header {
            padding: 10px 15px; font-size: 14px; font-weight: bold; color: #333;
            border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;
        }
        .tasks-header .refresh-btn {
            background: none; border: none; cursor: pointer; font-size: 14px;
            color: #888; transition: transform 0.3s;
        }
        .tasks-header .refresh-btn:hover { color: #333; }
        .tasks-header .refresh-btn.spinning { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .tasks-list { max-height: 300px; overflow-y: auto; }
        .task-item {
            display: flex; align-items: center; gap: 10px; padding: 10px 15px;
            border-bottom: 1px solid #f0f0f0; transition: background 0.2s;
        }
        .task-item:last-child { border-bottom: none; }
        .task-item:hover { background: #f8f8f8; }
        .task-item.completed { opacity: 0.5; }
        .task-item.completed .task-title { text-decoration: line-through; }
        
        .task-checkbox {
            width: 20px; height: 20px; border: 2px solid #ccc; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; flex-shrink: 0;
        }
        .task-checkbox:hover { border-color: #22c55e; }
        .task-checkbox.checked { background: #22c55e; border-color: #22c55e; }
        .task-checkbox.checked::after { content: '‚úì'; color: white; font-size: 12px; }
        
        .task-info { flex: 1; min-width: 0; }
        .task-title { font-size: 14px; color: #333; margin-bottom: 2px; }
        .task-due { font-size: 11px; color: #888; }
        .task-due.overdue { color: #ef4444; }
        .task-due.today { color: #f59e0b; }
        
        .task-importance { width: 6px; height: 6px; border-radius: 50%; background: #ccc; flex-shrink: 0; }
        .task-importance.high { background: #ef4444; }
        
        .tasks-empty { padding: 20px; text-align: center; color: #888; font-size: 13px; }
        .tasks-login-prompt { padding: 20px; text-align: center; color: #666; font-size: 13px; }
        .tasks-login-prompt button {
            margin-top: 10px; background: #0078d4; color: white; border: none;
            padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;
        }
        
        /* Reinigung */
        .reinigung-list { padding: 10px 0; max-height: 250px; overflow-y: auto; }
        .reinigung-item {
            display: flex; padding: 8px 15px; border-bottom: 1px solid #e0e0e0;
            align-items: center; gap: 10px;
        }
        .reinigung-item:last-child { border-bottom: none; }
        .reinigung-date { font-weight: bold; min-width: 60px; font-size: 14px; color: #1E88E5; }
        .reinigung-type { padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; color: white; }
        .reinigung-type.gross { background: #ef4444; }
        .reinigung-type.mittel { background: #f59e0b; }
        
        .calendar-list, .shiftplan-list { padding: 10px 0; max-height: 400px; overflow-y: auto; }
        .calendar-item {
            display: flex; padding: 10px 15px; border-bottom: 1px solid #f0f0f0;
            align-items: center; gap: 12px;
        }
        .calendar-item:last-child { border-bottom: none; }
        .calendar-date { font-weight: bold; min-width: 70px; font-size: 14px; }
        .calendar-day { color: #666; font-size: 12px; min-width: 30px; }
        .calendar-event { flex: 1; font-size: 14px; }
        .calendar-tech {
            background: #757575; color: white; padding: 3px 8px;
            border-radius: 4px; font-size: 12px; font-weight: bold;
        }
        .technik .calendar-date { color: #757575; }
        .sputnik .calendar-date { color: #8E24AA; }
        .calendar-time { color: #666; font-size: 12px; min-width: 50px; }
        .calendar-pax { background: #8E24AA; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; }
        
        .tag-club { background: #757575; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px; }
        
        .tasks-btn {
            color: white; padding: 12px; border-radius: 8px; font-size: 14px;
            text-decoration: none; text-align: center; display: block;
            width: 100%; font-weight: bold; margin-top: 10px; border: none; cursor: pointer;
        }
        .tasks-btn:hover { opacity: 0.9; }
        .office .tasks-btn { background: #1E88E5; }
        .bar .tasks-btn { background: #F4511E; }
        .runner .tasks-btn { background: #43A047; }
        .sputnik .tasks-btn { background: #8E24AA; }
        .technik .tasks-btn { background: #757575; }
        
        .footer { margin-top: 25px; text-align: center; }
        .footer a {
            background: #2d2d44; color: white; padding: 15px 30px;
            border-radius: 10px; text-decoration: none; display: inline-block; font-size: 16px;
        }
        .footer a:hover { background: #3d3d54; }
        .version { color: #555; font-size: 11px; text-align: center; margin-top: 15px; }
        
        .loading-spinner {
            text-align: center; padding: 40px; color: #888;
        }
        .loading-spinner::after {
            content: ''; display: inline-block; width: 20px; height: 20px;
            border: 2px solid #3d3d54; border-top-color: #0078d4;
            border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ TURBO-PROJECTS</h1>
        <p>Work Hub Launcher</p>
    </div>
    
    <!-- Auth Status Bar -->
    <div class="auth-bar">
        <div class="auth-status">
            <span class="dot" id="auth-dot"></span>
            <span id="auth-status-text">Not connected</span>
        </div>
        <span class="auth-user" id="auth-user"></span>
        <button class="auth-btn" id="auth-btn" onclick="handleAuth()">
            <span>üîê</span> Sign in with Microsoft
        </button>
    </div>
    
    <!-- Toast notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Compose Email Modal -->
    <div class="modal-overlay" id="compose-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>‚úâÔ∏è Neue E-Mail</h3>
                <button class="modal-close" onclick="closeComposeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="template-btns">
                    <button class="template-btn" onclick="loadTemplate('security')">üîí Security Order</button>
                    <button class="template-btn" onclick="loadTemplate('booking')">üéµ Booking Anfrage</button>
                    <button class="template-btn" onclick="loadTemplate('hausverwaltung')">üè¢ Hausverwaltung</button>
                </div>
                <div class="form-group">
                    <label>An:</label>
                    <input type="email" id="email-to" placeholder="empfaenger@email.com">
                </div>
                <div class="form-group">
                    <label>Betreff:</label>
                    <input type="text" id="email-subject" placeholder="Betreff">
                </div>
                <div class="form-group">
                    <label>Nachricht:</label>
                    <textarea id="email-body" placeholder="Nachricht eingeben..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeComposeModal()">Abbrechen</button>
                <button class="modal-btn send" onclick="sendEmail()">üì§ Senden</button>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions Row 1 -->
    <div class="quick-actions">
        <a href="#" onclick="openFactsheetGenerator(); return false;" class="quick-btn">üìÑ Factsheet</a>
        <a href="#" onclick="openSecurityOrder(); return false;" class="quick-btn">üîí Security</a>
        <button class="quick-btn btn-email" onclick="openComposeModal()">‚úâÔ∏è E-Mail</button>
        <a href="https://club.bookmetender.com/dashboards" class="quick-btn" target="_blank">üìñ BMT</a>
    </div>
    
    <!-- Quick Actions Row 2 -->
    <div class="quick-actions-row2">
        <div class="dropdown-container">
            <button class="quick-btn dropdown-btn" onclick="toggleDropdown('social-dropdown')">üì± Social ‚ñº</button>
            <div id="social-dropdown" class="dropdown-content">
                <a href="https://www.instagram.com/grelle_forelle/" class="dropdown-item" target="_blank"><span class="icon">üì∏</span> Instagram</a>
                <a href="https://www.facebook.com/GrelleForelle/" class="dropdown-item" target="_blank"><span class="icon">üìò</span> Facebook</a>
            </div>
        </div>
        <div class="dropdown-container">
            <button class="quick-btn dropdown-btn sales" onclick="toggleDropdown('sales-dropdown')">üí∞ Sales ‚ñº</button>
            <div id="sales-dropdown" class="dropdown-content">
                <a href="https://wbv.azurewebsites.net/default.aspx" class="dropdown-item" target="_blank"><span class="icon">üí≥</span> WBV (POS)</a>
                <a href="https://linktr.ee/grelletickets" class="dropdown-item" target="_blank"><span class="icon">üîó</span> Linktree</a>
                <a href="https://ntry.at/my/events?l=de" class="dropdown-item" target="_blank"><span class="icon">üéüÔ∏è</span> ntry (Pre-Sale)</a>
            </div>
        </div>
        <a href="https://drive.google.com/drive/folders/1w7spIO25kEPGOfv1MLi73fMfKapemKB9" class="quick-btn btn-graphics" target="_blank">üìÅ Graphics</a>
        <a href="https://wa.me/" class="quick-btn btn-whatsapp" target="_blank">üí¨ WhatsApp</a>
    </div>
    
    <!-- Quick Actions Row 3 -->
    <div class="quick-actions-row3">
        <button class="quick-btn btn-post-creator" onclick="openPostCreator()">‚ú® Post Creator</button>
        <button class="quick-btn btn-calculator" onclick="openCostCalculator()">üßÆ Cost Calc</button>
        <button class="quick-btn btn-presale" onclick="openPresaleCalculator()">üéüÔ∏è PreSale Calc</button>
        <button class="quick-btn" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);" onclick="openEventProjector()">üìä Projector</button>
    </div>
    
    <!-- Outlook Section -->
    <div class="outlook-section" id="outlook-section">
        <div class="outlook-header">
            <h2>üì¨ Outlook</h2>
            <div class="outlook-tabs">
                <button class="outlook-tab active" onclick="switchOutlookTab('inbox')">üìß Inbox</button>
                <button class="outlook-tab" onclick="switchOutlookTab('calendar')">üìÖ Kalender</button>
            </div>
        </div>
        <div class="outlook-content">
            <!-- Inbox Panel -->
            <div class="outlook-panel active" id="inbox-panel">
                <div class="email-list" id="email-list">
                    <div class="tasks-login-prompt">
                        <p>Sign in um deine Emails zu sehen</p>
                        <button onclick="handleAuth()">üîê Mit Microsoft anmelden</button>
                    </div>
                </div>
            </div>
            <!-- Calendar Panel -->
            <div class="outlook-panel" id="calendar-panel">
                <div class="calendar-events" id="calendar-events">
                    <div class="tasks-login-prompt">
                        <p>Sign in um deinen Kalender zu sehen</p>
                        <button onclick="handleAuth()">üîê Mit Microsoft anmelden</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upcoming Events Dashboard -->
    <div class="upcoming-events">
        <div class="upcoming-header">
            <span class="upcoming-title">üìÖ UPCOMING EVENTS</span>
        </div>
        
        <div class="upcoming-week-label current">üî¥ DIESE WOCHE (KW 52)</div>
        
        <!-- TURBO - SA 27.12 -->
        <div class="event-card" id="event-turbo27" data-event-date="2025-12-27" data-serie="TURBO">
            <div class="event-card-header" onclick="toggleEventCard('event-turbo27')">
                <div class="event-main-info">
                    <span class="event-date">SA 27.12</span>
                    <span class="event-name">TURBO</span>
                    <span class="event-tech">Simon</span>
                </div>
                <div class="event-quick-stats">
                    <span id="turbo-bar-quick">üç∫ ~‚Ç¨14.5k</span>
                    <span id="turbo-tickets-quick">üé´ ~763</span>
                    <span class="event-toggle">‚ñº</span>
                </div>
            </div>
            <div class="event-details">
                <div class="vvk-tracker">
                    <div class="vvk-input-row">
                        <label>üéØ Ziel:</label>
                        <input type="number" id="turbo-ziel-input" value="450" oninput="updateProjection('turbo')">
                        <label>üìä Max:</label>
                        <input type="number" id="turbo-max-input" value="600" oninput="updateProjection('turbo')">
                        <label>üé´ Aktuell:</label>
                        <input type="number" id="turbo-vvk-input" placeholder="0" oninput="updateProjection('turbo')">
                        <span class="vvk-days" id="turbo-days">5 Tage</span>
                    </div>
                    <div class="vvk-input-row">
                        <label>üí∂ √ò VVK ‚Ç¨:</label>
                        <input type="number" id="turbo-vvk-price" value="18" oninput="updateProjection('turbo')">
                        <label>üö™ FOH ‚Ç¨:</label>
                        <input type="number" id="turbo-foh-price" value="22" oninput="updateProjection('turbo')">
                    </div>
                    <div class="vvk-progress-bar">
                        <div class="vvk-progress" id="turbo-progress" style="width: 0%"></div>
                    </div>
                    <div class="vvk-benchmark" id="turbo-benchmark">Ziel: 450 | Max: 600 | 55% bei 5d ‚Üí Soll ~248</div>
                </div>
                <div class="auto-projection">
                    <div class="projection-grid">
                        <div class="proj-box">
                            <div class="proj-box-label">VVK Proj.</div>
                            <div class="proj-box-value tickets" id="turbo-vvk-proj">~426</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">FOH Proj.</div>
                            <div class="proj-box-value tickets" id="turbo-foh-proj">~337</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Bar Proj.</div>
                            <div class="proj-box-value bar" id="turbo-bar-proj">~‚Ç¨14.5k</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Total Rev</div>
                            <div class="proj-box-value total" id="turbo-total-proj">~‚Ç¨29.8k</div>
                        </div>
                    </div>
                    <div class="projection-basis" id="turbo-basis">üìä TURBO √ò: 436 VVK, 336 FOH (25 Events) | KW52: ‚Ç¨16.3/Person</div>
                </div>
                <div class="cvd-badge">üëî CVD: Alain</div>
                <div class="event-actions">
                    <button class="event-action-btn primary" onclick="requestFactsheet('TURBO', 'Samstag, 27.12.2025', 'MAIN_00', 'Eigenveranstaltung', 'Simon')">üìÑ Factsheet</button>
                    <button class="event-action-btn" onclick="requestSecurityOrder('TURBO', 'Samstag', '27.12.25', 'MAIN_00')">üîí Security</button>
                    <button class="event-action-btn" onclick="window.open('https://ntry.at/my/events?l=de', '_blank')">üé´ NTRY</button>
                </div>
            </div>
        </div>
        
        <!-- NYE - DI 31.12 -->
        <div class="event-card" id="event-silvester" data-event-date="2025-12-31" data-serie="NYE">
            <div class="event-card-header" onclick="toggleEventCard('event-silvester')">
                <div class="event-main-info">
                    <span class="event-date">DI 31.12</span>
                    <span class="event-name">SILVESTER</span>
                    <span class="event-tech">Jan</span>
                </div>
                <div class="event-quick-stats">
                    <span id="nye-bar-quick">üç∫ ~‚Ç¨23k</span>
                    <span id="nye-tickets-quick">üé´ ~1153</span>
                    <span class="event-toggle">‚ñº</span>
                </div>
            </div>
            <div class="event-details">
                <div class="vvk-tracker">
                    <div class="vvk-input-row">
                        <label>üéØ Ziel:</label>
                        <input type="number" id="nye-ziel-input" value="450" oninput="updateProjection('nye')">
                        <label>üìä Max:</label>
                        <input type="number" id="nye-max-input" value="700" oninput="updateProjection('nye')">
                        <label>üé´ Aktuell:</label>
                        <input type="number" id="nye-vvk-input" placeholder="0" oninput="updateProjection('nye')">
                        <span class="vvk-days" id="nye-days">9 Tage</span>
                    </div>
                    <div class="vvk-input-row">
                        <label>üí∂ √ò VVK ‚Ç¨:</label>
                        <input type="number" id="nye-vvk-price" value="25" oninput="updateProjection('nye')">
                        <label>üö™ FOH ‚Ç¨:</label>
                        <input type="number" id="nye-foh-price" value="26" oninput="updateProjection('nye')">
                    </div>
                    <div class="vvk-progress-bar">
                        <div class="vvk-progress" id="nye-progress" style="width: 0%"></div>
                    </div>
                    <div class="vvk-benchmark" id="nye-benchmark">Ziel: 450 | Max: 700 | 40% bei 9d ‚Üí Soll ~180</div>
                </div>
                <div class="auto-projection">
                    <div class="projection-grid">
                        <div class="proj-box">
                            <div class="proj-box-label">VVK Proj.</div>
                            <div class="proj-box-value tickets" id="nye-vvk-proj">~522</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">FOH Proj.</div>
                            <div class="proj-box-value tickets" id="nye-foh-proj">~631</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Bar Proj.</div>
                            <div class="proj-box-value bar" id="nye-bar-proj">~‚Ç¨23k</div>
                        </div>
                        <div class="proj-box">
                            <div class="proj-box-label">Total Rev</div>
                            <div class="proj-box-value total" id="nye-total-proj">~‚Ç¨46k</div>
                        </div>
                    </div>
                    <div class="projection-basis" id="nye-basis">üìä NYE √ò: 562 VVK, 649 FOH (1 Event) | KW52: ‚Ç¨16.3/Person</div>
                </div>
                <div class="cvd-badge">üëî CVD: Alain / Niat</div>
                <div class="event-actions">
                    <button class="event-action-btn primary" onclick="requestFactsheet('NYE SILVESTER', 'Dienstag, 31.12.2025', 'MAIN_00', 'Eigenveranstaltung', 'Jan')">üìÑ Factsheet</button>
                    <button class="event-action-btn" onclick="requestSecurityOrder('Silvester', 'Dienstag', '31.12.25', 'MAIN_00')">üîí Security</button>
                    <button class="event-action-btn" onclick="window.open('https://ntry.at/my/events?l=de', '_blank')">üé´ NTRY</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="departments">
        <!-- OFFICE -->
        <div class="dept office">
            <div class="dept-header">
                <div class="dept-header-left">üíº OFFICE</div>
                <span class="task-count" id="office-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üßπ Reinigungsplan</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="reinigung-list">
                            <div class="reinigung-item"><span class="reinigung-date">02.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">07.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">10.01</span><span class="reinigung-type gross">GROSS</span></div>
                            <div class="reinigung-item"><span class="reinigung-date">12.01</span><span class="reinigung-type gross">GROSS</span></div>
                        </div>
                    </div>
                </div>
                <div class="tasks-inline" id="office-tasks">
                    <div class="tasks-header">
                        <span>üìù Tasks</span>
                        <button class="refresh-btn" onclick="refreshTasks('office')" title="Refresh">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="office-tasks-list">
                        <div class="tasks-login-prompt">
                            <p>Sign in to see your tasks</p>
                            <button onclick="handleAuth()">üîê Connect Microsoft To Do</button>
                        </div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('office')">üìù Open in Microsoft To Do</button>
            </div>
        </div>
        
        <!-- BAR -->
        <div class="dept bar">
            <div class="dept-header">
                <div class="dept-header-left">üç∑ BAR</div>
                <span class="task-count" id="bar-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìã Shiftplan Dezember + Januar</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <iframe src="https://docs.google.com/document/d/e/2PACX-1vQLF5-vQFf1CZ2tEyVyVdD7uO088yl8CWDlQdWa61m0uhEbOB9FWuDU2wVBkJH_XxJMW_B01QOKFyAr/pub?embedded=true" style="height:500px; background:#fff;"></iframe>
                    </div>
                </div>
                <div class="tasks-inline" id="bar-tasks">
                    <div class="tasks-header">
                        <span>üìù Tasks</span>
                        <button class="refresh-btn" onclick="refreshTasks('bar')" title="Refresh">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="bar-tasks-list">
                        <div class="tasks-login-prompt">
                            <p>Sign in to see your tasks</p>
                            <button onclick="handleAuth()">üîê Connect Microsoft To Do</button>
                        </div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('bar')">üìù Open in Microsoft To Do</button>
            </div>
        </div>
        
        <!-- RUNNER -->
        <div class="dept runner">
            <div class="dept-header">
                <div class="dept-header-left">üèÉ RUNNER</div>
                <span class="task-count" id="runner-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìã Shiftplan Dezember + Januar</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <iframe src="https://docs.google.com/document/d/e/2PACX-1vQf_QmeV8FxX-7zYGW1qi1t0D9WJjEk47bYCbXBGey4qAbDY5dU3yw_ByQ6jY1r59sUFlS_8NmCy3jl/pub?embedded=true" style="height:500px; background:#fff;"></iframe>
                    </div>
                </div>
                <div class="tasks-inline" id="runner-tasks">
                    <div class="tasks-header">
                        <span>üìù Tasks</span>
                        <button class="refresh-btn" onclick="refreshTasks('runner')" title="Refresh">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="runner-tasks-list">
                        <div class="tasks-login-prompt">
                            <p>Sign in to see your tasks</p>
                            <button onclick="handleAuth()">üîê Connect Microsoft To Do</button>
                        </div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('runner')">üìù Open in Microsoft To Do</button>
            </div>
        </div>
        
        <!-- TECHNIK -->
        <div class="dept technik">
            <div class="dept-header">
                <div class="dept-header-left">üîß TECHNIK</div>
                <span class="task-count" id="technik-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìÖ Technikerkalender</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="calendar-list">
                            <div class="calendar-item">
                                <span class="calendar-date">27. Dez</span>
                                <span class="calendar-day">SA</span>
                                <span class="calendar-event">TURBO<span class="tag-club">Club</span></span>
                                <span class="calendar-tech">Simon</span>
                            </div>
                            <div class="calendar-item">
                                <span class="calendar-date">31. Dez</span>
                                <span class="calendar-day">DI</span>
                                <span class="calendar-event">Silvester<span class="tag-club">Club</span></span>
                                <span class="calendar-tech">Jan</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tasks-inline" id="technik-tasks">
                    <div class="tasks-header">
                        <span>üìù Tasks</span>
                        <button class="refresh-btn" onclick="refreshTasks('technik')" title="Refresh">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="technik-tasks-list">
                        <div class="tasks-login-prompt">
                            <p>Sign in to see your tasks</p>
                            <button onclick="handleAuth()">üîê Connect Microsoft To Do</button>
                        </div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('technik')">üìù Open in Microsoft To Do</button>
            </div>
        </div>
        
        <!-- SPUTNIK -->
        <div class="dept sputnik">
            <div class="dept-header">
                <div class="dept-header-left">üç∏ SPUTNIK BAR</div>
                <span class="task-count" id="sputnik-task-count">‚Äî</span>
            </div>
            <div class="dept-content">
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìã Shiftplan</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <iframe src="https://docs.google.com/document/d/e/2PACX-1vTayJTFCmEUh8Nh3QWQS6EfC15Q0dHBpc8GH_iC8A-yOlqIn6ARYW5XF0TmGQnWWgKqqfDMQp19i7iw/pub?embedded=true" style="height:500px; background:#fff;"></iframe>
                    </div>
                </div>
                <div class="collapsible-section">
                    <div class="section-label" onclick="toggleSection(this)">
                        <span>üìÖ Reservierungen</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="calendar-list">
                            <div class="calendar-item">
                                <span class="calendar-date">27. Dez</span>
                                <span class="calendar-day">SA</span>
                                <span class="calendar-time">19:00</span>
                                <span class="calendar-event">Reservierung</span>
                                <span class="calendar-pax">TBA</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tasks-inline" id="sputnik-tasks">
                    <div class="tasks-header">
                        <span>üìù Tasks</span>
                        <button class="refresh-btn" onclick="refreshTasks('sputnik')" title="Refresh">üîÑ</button>
                    </div>
                    <div class="tasks-list" id="sputnik-tasks-list">
                        <div class="tasks-login-prompt">
                            <p>Sign in to see your tasks</p>
                            <button onclick="handleAuth()">üîê Connect Microsoft To Do</button>
                        </div>
                    </div>
                </div>
                <button class="tasks-btn" onclick="openToDoList('sputnik')">üìù Open in Microsoft To Do</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <a href="https://to-do.live.com" target="_blank">‚úÖ Open Microsoft To Do</a>
    </div>
    
    <div class="version">Work Hub Launcher v12.1 ‚Ä¢ 23.12.2025 ‚Ä¢ Outlook Integration</div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MICROSOFT AUTHENTICATION - MSAL.js Configuration
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const msalConfig = {
            auth: {
                clientId: "0fc00e3e-4ff3-4806-ae4a-222d1abee84b",
                authority: "https://login.microsoftonline.com/common",
                redirectUri: window.location.origin + window.location.pathname
            },
            cache: {
                cacheLocation: "localStorage",
                storeAuthStateInCookie: false
            }
        };
        
        // Extended scopes for Outlook
        const loginRequest = {
            scopes: ["Tasks.ReadWrite", "User.Read", "Mail.Read", "Mail.Send", "Calendars.Read"]
        };
        
        // To Do List IDs
        const TODO_LISTS = {
            office: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqn88jwAAAA==",
            bar: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E7QAAAA==",
            runner: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E7gAAAA==",
            technik: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E7wAAAA==",
            sputnik: "AQMkADAwATM0MDAAMS0yZjI4LTJjYTktMDACLTAwCgAuAAADxd_TrPbkZEisrfPVcCAWnQEArwnaZSdg_UuQLE65Sg5hCAAEqb6E8AAAAA=="
        };
        
        // Email Templates
        const EMAIL_TEMPLATES = {
            security: {
                to: "",
                subject: "Security Bestellung - Grelle Forelle",
                body: `Hallo,

Hier die Bestellung f√ºr die n√§chsten Events.

[WOCHENTAG] [DATUM] ‚Äî [EVENT]
- 22:45 ‚Äî 1 PAX
- 23:00 ‚Äî 1 PAX
- 23:30 ‚Äî 1 PAX
- 00:00 ‚Äî 3 PAX
- 01:00 ‚Äî 1 PAX

Bitte um Best√§tigung. Danke

--
Schadi Tayyah
st@grelleforelle.com
Grelle Forelle CEO
Turbo Projects GmbH
Spittelauer L√§nde 12/1
1090 Vienna, Austria`
            },
            booking: {
                to: "",
                subject: "Booking Anfrage - Grelle Forelle",
                body: `Hallo,

ich w√ºrde gerne folgendes anfragen:

[DETAILS]

Bitte um R√ºckmeldung.

Beste Gr√º√üe,

--
Schadi Tayyah
st@grelleforelle.com
Grelle Forelle CEO
Turbo Projects GmbH
Spittelauer L√§nde 12/1
1090 Vienna, Austria`
            },
            hausverwaltung: {
                to: "",
                subject: "Anfrage - Grelle Forelle / Turbo Projects",
                body: `Sehr geehrte Damen und Herren,

[ANLIEGEN]

Mit freundlichen Gr√º√üen,

--
Schadi Tayyah
st@grelleforelle.com
Grelle Forelle CEO
Turbo Projects GmbH
Spittelauer L√§nde 12/1
1090 Vienna, Austria`
            }
        };
        
        let msalInstance = null;
        let accessToken = null;
        
        // Initialize MSAL
        async function initMsal() {
            try {
                msalInstance = new msal.PublicClientApplication(msalConfig);
                await msalInstance.initialize();
                
                const response = await msalInstance.handleRedirectPromise();
                if (response) {
                    accessToken = response.accessToken;
                    updateAuthUI(response.account);
                    loadAllData();
                } else {
                    const accounts = msalInstance.getAllAccounts();
                    if (accounts.length > 0) {
                        try {
                            const silentResponse = await msalInstance.acquireTokenSilent({
                                ...loginRequest,
                                account: accounts[0]
                            });
                            accessToken = silentResponse.accessToken;
                            updateAuthUI(accounts[0]);
                            loadAllData();
                        } catch (e) {
                            console.log("Silent token acquisition failed");
                        }
                    }
                }
            } catch (error) {
                console.error("MSAL initialization error:", error);
            }
        }
        
        // Handle login/logout
        async function handleAuth() {
            if (accessToken) {
                msalInstance.logoutPopup();
                accessToken = null;
                updateAuthUI(null);
                resetAllUI();
            } else {
                try {
                    const response = await msalInstance.loginPopup(loginRequest);
                    accessToken = response.accessToken;
                    updateAuthUI(response.account);
                    loadAllData();
                    showToast("‚úÖ Verbunden mit Microsoft!");
                } catch (error) {
                    console.error("Login error:", error);
                    showToast("‚ùå Login fehlgeschlagen", true);
                }
            }
        }
        
        // Update auth UI
        function updateAuthUI(account) {
            const dot = document.getElementById('auth-dot');
            const statusText = document.getElementById('auth-status-text');
            const userText = document.getElementById('auth-user');
            const authBtn = document.getElementById('auth-btn');
            
            if (account) {
                dot.classList.add('connected');
                statusText.textContent = 'Verbunden';
                userText.textContent = account.username || account.name || '';
                authBtn.innerHTML = '<span>üö™</span> Abmelden';
                authBtn.classList.add('logout');
            } else {
                dot.classList.remove('connected');
                statusText.textContent = 'Nicht verbunden';
                userText.textContent = '';
                authBtn.innerHTML = '<span>üîê</span> Mit Microsoft anmelden';
                authBtn.classList.remove('logout');
            }
        }
        
        // Load all data after login
        function loadAllData() {
            loadAllTasks();
            loadEmails();
            loadCalendar();
        }
        
        // Reset all UI when logged out
        function resetAllUI() {
            resetTasksUI();
            document.getElementById('email-list').innerHTML = `
                <div class="tasks-login-prompt">
                    <p>Sign in um deine Emails zu sehen</p>
                    <button onclick="handleAuth()">üîê Mit Microsoft anmelden</button>
                </div>
            `;
            document.getElementById('calendar-events').innerHTML = `
                <div class="tasks-login-prompt">
                    <p>Sign in um deinen Kalender zu sehen</p>
                    <button onclick="handleAuth()">üîê Mit Microsoft anmelden</button>
                </div>
            `;
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // OUTLOOK - EMAIL FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function loadEmails() {
            if (!accessToken) return;
            
            const emailList = document.getElementById('email-list');
            emailList.innerHTML = '<div class="loading-spinner">Lade Emails</div>';
            
            try {
                const response = await fetch(
                    'https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages?$top=10&$orderby=receivedDateTime desc&$select=id,subject,bodyPreview,from,receivedDateTime,isRead',
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                const emails = data.value || [];
                
                if (emails.length === 0) {
                    emailList.innerHTML = '<div class="tasks-empty">üì≠ Keine Emails</div>';
                } else {
                    emailList.innerHTML = emails.map(email => renderEmail(email)).join('');
                }
            } catch (error) {
                console.error("Error loading emails:", error);
                emailList.innerHTML = '<div class="tasks-empty">‚ö†Ô∏è Emails konnten nicht geladen werden</div>';
            }
        }
        
        function renderEmail(email) {
            const fromName = email.from?.emailAddress?.name || email.from?.emailAddress?.address || 'Unknown';
            const initials = fromName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            const time = formatEmailTime(email.receivedDateTime);
            const isUnread = !email.isRead;
            
            return `
                <div class="email-item ${isUnread ? 'unread' : ''}" onclick="openEmail('${email.id}')">
                    <div class="email-avatar">${initials}</div>
                    <div class="email-content">
                        <div class="email-header">
                            <span class="email-from">${escapeHtml(fromName)}</span>
                            <span class="email-time">${time}</span>
                        </div>
                        <div class="email-subject">${escapeHtml(email.subject || '(Kein Betreff)')}</div>
                        <div class="email-preview">${escapeHtml(email.bodyPreview || '')}</div>
                    </div>
                </div>
            `;
        }
        
        function formatEmailTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return `vor ${diffMins}m`;
            if (diffHours < 24) return `vor ${diffHours}h`;
            if (diffDays < 7) return `vor ${diffDays}d`;
            return date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' });
        }
        
        function openEmail(emailId) {
            window.open(`https://outlook.office.com/mail/inbox/id/${emailId}`, '_blank');
        }
        
        // Compose Email
        function openComposeModal() {
            document.getElementById('compose-modal').classList.add('show');
            document.getElementById('email-to').value = '';
            document.getElementById('email-subject').value = '';
            document.getElementById('email-body').value = '';
        }
        
        function closeComposeModal() {
            document.getElementById('compose-modal').classList.remove('show');
        }
        
        function loadTemplate(templateName) {
            const template = EMAIL_TEMPLATES[templateName];
            if (template) {
                document.getElementById('email-to').value = template.to;
                document.getElementById('email-subject').value = template.subject;
                document.getElementById('email-body').value = template.body;
            }
        }
        
        async function sendEmail() {
            if (!accessToken) {
                showToast("‚ùå Bitte erst anmelden", true);
                return;
            }
            
            const to = document.getElementById('email-to').value.trim();
            const subject = document.getElementById('email-subject').value.trim();
            const body = document.getElementById('email-body').value.trim();
            
            if (!to || !subject || !body) {
                showToast("‚ùå Bitte alle Felder ausf√ºllen", true);
                return;
            }
            
            try {
                const response = await fetch('https://graph.microsoft.com/v1.0/me/sendMail', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: {
                            subject: subject,
                            body: {
                                contentType: "Text",
                                content: body
                            },
                            toRecipients: [
                                { emailAddress: { address: to } }
                            ]
                        }
                    })
                });
                
                if (response.ok || response.status === 202) {
                    showToast("‚úÖ Email gesendet!");
                    closeComposeModal();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error("Error sending email:", error);
                showToast("‚ùå Email konnte nicht gesendet werden", true);
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // OUTLOOK - CALENDAR FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function loadCalendar() {
            if (!accessToken) return;
            
            const calendarEl = document.getElementById('calendar-events');
            calendarEl.innerHTML = '<div class="loading-spinner">Lade Kalender</div>';
            
            const now = new Date();
            const endDate = new Date(now.getTime() + 14 * 24 * 60 * 60 * 1000); // 2 weeks ahead
            
            try {
                const response = await fetch(
                    `https://graph.microsoft.com/v1.0/me/calendarview?startDateTime=${now.toISOString()}&endDateTime=${endDate.toISOString()}&$top=15&$orderby=start/dateTime&$select=id,subject,start,end,location,isAllDay`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'outlook.timezone="Europe/Vienna"'
                        }
                    }
                );
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                const events = data.value || [];
                
                if (events.length === 0) {
                    calendarEl.innerHTML = '<div class="tasks-empty">üìÖ Keine Termine in den n√§chsten 2 Wochen</div>';
                } else {
                    calendarEl.innerHTML = events.map(event => renderCalendarEvent(event)).join('');
                }
            } catch (error) {
                console.error("Error loading calendar:", error);
                calendarEl.innerHTML = '<div class="tasks-empty">‚ö†Ô∏è Kalender konnte nicht geladen werden</div>';
            }
        }
        
        function renderCalendarEvent(event) {
            const startDate = new Date(event.start.dateTime + 'Z');
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
            const eventDay = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
            
            let dayClass = '';
            let dateLabel = '';
            
            if (eventDay.getTime() === today.getTime()) {
                dayClass = 'today';
                dateLabel = 'Heute';
            } else if (eventDay.getTime() === tomorrow.getTime()) {
                dayClass = 'tomorrow';
                dateLabel = 'Morgen';
            } else {
                dateLabel = startDate.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' });
            }
            
            const timeLabel = event.isAllDay ? 'Ganzt√§gig' : startDate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
            const location = event.location?.displayName || '';
            
            return `
                <div class="calendar-event-item ${dayClass}">
                    <div class="event-time-block">
                        <div class="event-date-label">${dateLabel}</div>
                        <div class="event-time-label">${timeLabel}</div>
                    </div>
                    <div class="event-details">
                        <div class="event-title">${escapeHtml(event.subject || '(Kein Titel)')}</div>
                        ${location ? `<div class="event-location">üìç ${escapeHtml(location)}</div>` : ''}
                    </div>
                </div>
            `;
        }
        
        // Switch Outlook tabs
        function switchOutlookTab(tab) {
            document.querySelectorAll('.outlook-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.outlook-panel').forEach(p => p.classList.remove('active'));
            
            document.querySelector(`.outlook-tab[onclick*="${tab}"]`).classList.add('active');
            document.getElementById(`${tab}-panel`).classList.add('active');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TO DO - TASK FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function resetTasksUI() {
            const depts = ['office', 'bar', 'runner', 'technik', 'sputnik'];
            depts.forEach(dept => {
                document.getElementById(`${dept}-task-count`).textContent = '‚Äî';
                document.getElementById(`${dept}-tasks-list`).innerHTML = `
                    <div class="tasks-login-prompt">
                        <p>Sign in to see your tasks</p>
                        <button onclick="handleAuth()">üîê Connect Microsoft To Do</button>
                    </div>
                `;
            });
        }
        
        async function loadAllTasks() {
            if (!accessToken) return;
            const depts = ['office', 'bar', 'runner', 'technik', 'sputnik'];
            for (const dept of depts) {
                await loadTasks(dept);
            }
        }
        
        async function loadTasks(dept) {
            if (!accessToken) return;
            
            const listId = TODO_LISTS[dept];
            const countEl = document.getElementById(`${dept}-task-count`);
            const listEl = document.getElementById(`${dept}-tasks-list`);
            
            countEl.textContent = '...';
            countEl.classList.add('loading');
            
            try {
                const response = await fetch(
                    `https://graph.microsoft.com/v1.0/me/todo/lists/${listId}/tasks?$filter=status ne 'completed'&$orderby=importance desc,createdDateTime desc&$top=10`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                const tasks = data.value || [];
                
                countEl.textContent = tasks.length > 0 ? tasks.length : '‚úì';
                countEl.classList.remove('loading');
                
                if (tasks.length === 0) {
                    listEl.innerHTML = '<div class="tasks-empty">üéâ Alle Tasks erledigt!</div>';
                } else {
                    listEl.innerHTML = tasks.map(task => renderTask(task, dept)).join('');
                }
            } catch (error) {
                console.error(`Error loading ${dept} tasks:`, error);
                countEl.textContent = '!';
                countEl.classList.remove('loading');
                listEl.innerHTML = '<div class="tasks-empty">‚ö†Ô∏è Tasks konnten nicht geladen werden</div>';
            }
        }
        
        function renderTask(task, dept) {
            const isCompleted = task.status === 'completed';
            const isImportant = task.importance === 'high';
            
            let dueClass = '';
            let dueText = '';
            if (task.dueDateTime) {
                const dueDate = new Date(task.dueDateTime.dateTime + 'Z');
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (dueDate < today) {
                    dueClass = 'overdue';
                    dueText = `√úberf√§llig: ${dueDate.toLocaleDateString('de-DE')}`;
                } else if (dueDate.toDateString() === today.toDateString()) {
                    dueClass = 'today';
                    dueText = 'F√§llig heute';
                } else {
                    dueText = `F√§llig: ${dueDate.toLocaleDateString('de-DE')}`;
                }
            }
            
            return `
                <div class="task-item ${isCompleted ? 'completed' : ''}" data-task-id="${task.id}" data-dept="${dept}">
                    <div class="task-checkbox ${isCompleted ? 'checked' : ''}" onclick="toggleTask('${task.id}', '${dept}')"></div>
                    <div class="task-info">
                        <div class="task-title">${escapeHtml(task.title)}</div>
                        ${dueText ? `<div class="task-due ${dueClass}">${dueText}</div>` : ''}
                    </div>
                    ${isImportant ? '<div class="task-importance high"></div>' : ''}
                </div>
            `;
        }
        
        async function toggleTask(taskId, dept) {
            if (!accessToken) return;
            
            const listId = TODO_LISTS[dept];
            const taskEl = document.querySelector(`[data-task-id="${taskId}"]`);
            const checkbox = taskEl.querySelector('.task-checkbox');
            
            checkbox.classList.add('checked');
            taskEl.classList.add('completed');
            
            try {
                await fetch(
                    `https://graph.microsoft.com/v1.0/me/todo/lists/${listId}/tasks/${taskId}`,
                    {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'completed' })
                    }
                );
                showToast("‚úÖ Task erledigt!");
                setTimeout(() => loadTasks(dept), 500);
            } catch (error) {
                console.error("Error completing task:", error);
                checkbox.classList.remove('checked');
                taskEl.classList.remove('completed');
                showToast("‚ùå Task konnte nicht abgeschlossen werden", true);
            }
        }
        
        function refreshTasks(dept) {
            const btn = document.querySelector(`#${dept}-tasks .refresh-btn`);
            btn.classList.add('spinning');
            loadTasks(dept).then(() => btn.classList.remove('spinning'));
        }
        
        function openToDoList(dept) {
            const listId = TODO_LISTS[dept];
            window.open(`https://to-do.live.com/tasks/${listId}`, '_blank');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UTILITY FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // EXISTING WORK HUB FUNCTIONALITY
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const EIGENVERANSTALTUNGEN = ['turbo', 'selected', 'halloween', 'nye', 'silvester', 'birthday', 'x-mas', 'xmas', 'weihnacht', 'sommerfest'];
        
        function isEigenveranstaltung(eventName) {
            return EIGENVERANSTALTUNGEN.some(eigen => eventName.toLowerCase().includes(eigen));
        }
        
        function getKassa(eventName) {
            return isEigenveranstaltung(eventName) ? "Matth√§us / Schadi / Isa" : "FREMD";
        }

        const VVK_BENCHMARKS = { 14: 0.35, 10: 0.42, 7: 0.50, 5: 0.55, 3: 0.65, 2: 0.72, 1: 0.80, 0: 0.85 };
        const SERIE_STATS = {
            "turbo": { avgVVK: 436, avgFOH: 336, events: 25 },
            "nye": { avgVVK: 562, avgFOH: 649, events: 1 }
        };
        const KW_BAR_STATS = { "52": { barPerPerson: 16.3 } };
        const EVENT_CONFIG = {
            'turbo': { date: new Date('2025-12-27'), serie: 'turbo', kw: 52 },
            'nye': { date: new Date('2025-12-31'), serie: 'nye', kw: 52 }
        };
        
        function getDaysUntil(eventId) {
            const eventDate = EVENT_CONFIG[eventId].date;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return Math.max(0, Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24)));
        }
        
        function getBenchmarkForDays(days) {
            const benchmarkDays = Object.keys(VVK_BENCHMARKS).map(Number).sort((a, b) => b - a);
            for (let d of benchmarkDays) {
                if (days >= d) return { days: d, pct: VVK_BENCHMARKS[d] };
            }
            return { days: 0, pct: 0.85 };
        }
        
        function updateProjection(eventId) {
            const currentVVK = parseInt(document.getElementById(`${eventId}-vvk-input`).value) || 0;
            const vvkZiel = parseInt(document.getElementById(`${eventId}-ziel-input`).value) || 450;
            const maxVVK = parseInt(document.getElementById(`${eventId}-max-input`).value) || 600;
            const vvkPrice = parseFloat(document.getElementById(`${eventId}-vvk-price`).value) || 18;
            const fohPrice = parseFloat(document.getElementById(`${eventId}-foh-price`).value) || 22;
            
            const config = EVENT_CONFIG[eventId];
            const serie = SERIE_STATS[config.serie];
            const kwStats = KW_BAR_STATS[config.kw] || { barPerPerson: 16.5 };
            const daysUntil = getDaysUntil(eventId);
            const benchmark = getBenchmarkForDays(daysUntil);
            
            const fohRatio = serie.avgFOH / serie.avgVVK;
            let projectedVVK = currentVVK > 0 ? Math.min(Math.round(currentVVK / benchmark.pct), maxVVK) : Math.min(vvkZiel, maxVVK);
            let projectedFOH = Math.round(projectedVVK * fohRatio);
            const totalGuests = projectedVVK + projectedFOH;
            const projectedBar = totalGuests * kwStats.barPerPerson;
            const ticketRevenue = (projectedVVK * vvkPrice) + (projectedFOH * fohPrice);
            
            document.getElementById(`${eventId}-days`).textContent = `${daysUntil} Tage`;
            document.getElementById(`${eventId}-vvk-proj`).textContent = `~${projectedVVK}`;
            document.getElementById(`${eventId}-foh-proj`).textContent = `~${projectedFOH}`;
            document.getElementById(`${eventId}-bar-proj`).textContent = `~‚Ç¨${(projectedBar/1000).toFixed(1)}k`;
            document.getElementById(`${eventId}-total-proj`).textContent = `~‚Ç¨${((projectedBar + ticketRevenue)/1000).toFixed(1)}k`;
            document.getElementById(`${eventId}-tickets-quick`).textContent = `üé´ ~${totalGuests}`;
            document.getElementById(`${eventId}-bar-quick`).textContent = `üç∫ ~‚Ç¨${(projectedBar/1000).toFixed(1)}k`;
            
            const progressPct = Math.min(100, (currentVVK / vvkZiel) * 100);
            document.getElementById(`${eventId}-progress`).style.width = `${progressPct}%`;
            
            const expectedAtThisPoint = Math.round(vvkZiel * benchmark.pct);
            document.getElementById(`${eventId}-benchmark`).innerHTML = 
                `Ziel: ${vvkZiel} | Max: ${maxVVK} | ${Math.round(benchmark.pct * 100)}% bei ${daysUntil}d ‚Üí Soll ~${expectedAtThisPoint}`;
        }
        
        function initVVKTrackers() {
            updateProjection('turbo');
            updateProjection('nye');
        }

        function isMobile() { return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent); }
        
        function openClaudeOrCopy(prompt, successMsg) {
            if (isMobile()) {
                navigator.clipboard.writeText(prompt).then(() => showToast('üìã Prompt kopiert!'));
            } else {
                window.open('https://claude.ai/new?q=' + encodeURIComponent(prompt), '_blank');
                showToast(successMsg);
            }
        }
        
        function getFactsheetPrompt(eventName, datum, template, eventType, techniker) {
            const kassa = getKassa(eventName);
            return `Factsheet DOCX f√ºr Grelle Forelle: ${eventName} am ${datum}

FORMAT v3.0 - EINE TABELLE mit schwarzen Rahmen:
KASSA: ${kassa}
TECHNIK: ${techniker}

Google Docs IDs: Bar=1QBLAIqBc_noXBUVbJAUMzvChLK-2_SvXqfCMZQ7UGoI Runner=1O-1jjlmIgIluAd6ZigqBItw6TkZAD29ZcdhOntJ2I_I Garderobe=1WwLF4B42STLHzG9dcjZFFCz-ZWgYjAak8Vbxh5gFDxg`;
        }
        
        function requestFactsheet(eventName, datum, template, eventType, techniker) {
            openClaudeOrCopy(getFactsheetPrompt(eventName, datum, template, eventType, techniker), 'üìÑ Factsheet Generator...');
        }
        
        function openFactsheetGenerator() {
            openClaudeOrCopy('Factsheets f√ºr Grelle Forelle: 1) TURBO Sa 27.12.25 2) NYE Di 31.12.25', 'üìÑ Factsheet Generator...');
        }
        
        function requestSecurityOrder(eventName, weekday, date, template) {
            const content = `Hallo,

Hier die Bestellung f√ºr die n√§chsten Events.

${weekday} ${date} ‚Äî ${eventName}
- 22:45 ‚Äî 1 PAX
- 23:00 ‚Äî 1 PAX
- 23:30 ‚Äî 1 PAX
- 00:00 ‚Äî 3 PAX
- 01:00 ‚Äî 1 PAX

Bitte um Best√§tigung. Danke

--
Schadi Tayyah
st@grelleforelle.com
Grelle Forelle CEO
Turbo Projects GmbH
Spittelauer L√§nde 12/1
1090 Vienna, Austria`;
            navigator.clipboard.writeText(content).then(() => showToast('‚úÖ Security Order kopiert!'));
        }
        
        function openSecurityOrder() {
            openComposeModal();
            loadTemplate('security');
        }
        
        function toggleSection(label) {
            label.classList.toggle('open');
            label.nextElementSibling.classList.toggle('open');
        }
        
        function toggleDropdown(dropdownId) {
            document.querySelectorAll('.dropdown-content').forEach(d => {
                if (d.id !== dropdownId) d.classList.remove('show');
            });
            document.getElementById(dropdownId).classList.toggle('show');
        }
        
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown-container')) {
                document.querySelectorAll('.dropdown-content').forEach(d => d.classList.remove('show'));
            }
        });
        
        function toggleEventCard(cardId) { document.getElementById(cardId).classList.toggle('open'); }
        
        function openPostCreator() { openClaudeOrCopy('Post Creator', '‚ú® Post Creator...'); }
        function openCostCalculator() { openClaudeOrCopy('Cost Calculator', 'üßÆ Cost Calculator...'); }
        function openPresaleCalculator() { openClaudeOrCopy('PreSale Calculator', 'üéüÔ∏è PreSale Calculator...'); }
        function openEventProjector() { openClaudeOrCopy('Event Projector', 'üìä Event Projector...'); }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Work Hub v12.1 - Outlook Integration');
            initMsal();
            initVVKTrackers();
        });
    </script>
</body>
</html>
